# Implement Agent

GitHub Issue #{{issue_number}} の実装を行います。

> **重要: 非対話的実行**
> このセッションはバックグラウンドで実行されます。
> **絶対にエディタを開くコマンドを使用しないでください**。
> - `git commit` は必ず `-m` オプションを使用
> - `git merge` は `--no-edit` オプションを使用
> - 対話的なプロンプトが出るコマンドは使用しない

> **🚫 禁止事項**
> - **`gh issue close` を絶対に実行しないでください**
> - **`gh pr create` はこのステップでは実行しないでください**（mergeステップで行います）
> - IssueのCloseはPRマージ時に `Closes #xxx` で自動的に行われます
> - このステップはワークフローの一部です。完了マーカーを出力すると次のステップ（review）に進みます

## コンテキスト

- **Issue番号**: #{{issue_number}}
- **タイトル**: {{issue_title}}
- **ブランチ**: {{branch_name}}
- **作業ディレクトリ**: {{worktree_path}}

## タスク

### 1. 準備
- 実装計画書（存在する場合）を確認する
- 必要な依存関係を確認する
- 既存のコードスタイルとパターンを理解する

### 2. 実装
- 計画に従ってコードを実装する
- 既存のコードスタイルに従う
- 変更は最小限かつ焦点を絞ったものにする
- 適切なコメントを追加する

### 3. テスト
- 単体テストを追加・更新する
- テストを実行して全てパスすることを確認する
- 手動テストで動作確認を行う

### 4. コミット

> **必須**: `-m` オプションを使用してコミットメッセージを指定してください。
> エディタが開くとセッションがハングします。

```bash
git add -A
git commit -m "<type>: <description>

Refs #{{issue_number}}"
```

複数行のメッセージが必要な場合：
```bash
git commit -m "<type>: <description>" -m "Refs #{{issue_number}}"
```

## 完了条件

- [ ] 全ての要件が実装された
- [ ] テストが追加・更新された
- [ ] 全てのテストがパスした
- [ ] コードがコミットされた

## 完了報告

実装とコミットが正常に完了した場合は、以下の形式で完了マーカーを出力してください：

- プレフィックス: `###TASK`
- 中間部: `_COMPLETE_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

上記を連結して**行頭から直接**1行で出力してください（コードブロックやインデントは使用しないこと）。
これにより、次のステップ（レビュー）に進みます。

> **重要**: このマーカーは外部プロセス（`watch-session.sh`）によって監視されています。
> マーカーは必ず行頭から出力してください。インデントやコードブロック内での出力は検出されません。

## エラー報告

回復不能なエラーが発生した場合は、以下のマーカーを出力してください：

```bash
echo "###TASK_ERROR_{{issue_number}}###"
echo "エラーの説明"
```

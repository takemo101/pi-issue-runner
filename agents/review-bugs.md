# Review: バグ・ロジックエラー

`git diff origin/main` の変更を対象に、バグ・ロジックエラーの観点からレビューします。

## コンテキスト

- **Issue番号**: #{{issue_number}}
- **ブランチ**: {{branch_name}}
- **作業ディレクトリ**: {{worktree_path}}

## 手順

### 1. 変更差分を取得

```bash
git diff origin/main --stat
git diff origin/main
```

### 2. チェック項目

以下の観点で変更をレビューしてください：

- **未処理のエッジケース**: 空文字列、空配列、null/未定義の入力
- **off-by-one エラー**: ループ範囲、配列インデックス、行番号計算
- **null/未定義参照**: 未初期化変数、戻り値の未チェック
- **型の不一致**: 文字列と数値の比較、配列とスカラーの混同
- **例外処理の漏れ**: コマンド失敗時の処理、`set -e` 下での戻り値
- **リソースリーク**: 一時ファイルの未削除、プロセスの未終了
- **競合状態**: 並列実行時のファイルアクセス、ステータスファイルの更新タイミング

### 3. 出力規約

問題なしの場合:
```
APPROVED
```

問題ありの場合:
```
## 指摘事項

### [重大度: HIGH] ファイル名:行番号
説明...

### [重大度: MEDIUM] ファイル名:行番号
説明...
```

- **HIGH**: ランタイムエラーやデータ破損を引き起こす可能性が高い問題
- **MEDIUM**: 特定条件下で問題になりうる潜在的バグ
- **LOW**: コード品質の改善提案

### 4. 修正

重大度 HIGH の指摘がある場合は、直接修正してコミットしてください。

```bash
git add -A
git commit -m "fix: レビュー指摘の修正（バグ・ロジック）"
```

MEDIUM/LOW の指摘は情報提供のみとし、修正は任意です。

## 完了条件

- [ ] 全変更差分をレビューした
- [ ] HIGH の指摘があれば修正した
- [ ] 修正後にテストが通ることを確認した（修正した場合）

## 完了マーカー

レビュー完了後、以下のマーカーを出力してください：

- プレフィックス: `###TASK`
- 中間部: `_COMPLETE_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

上記を連結して**行頭から直接**1行で出力してください。

## エラー報告

回復不能なエラーが発生した場合：

```bash
mkdir -p "{{signal_dir}}" && echo "エラーの説明" > "{{signal_dir}}/signal-error-{{issue_number}}"
```

- プレフィックス: `###TASK`
- 中間部: `_ERROR_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

# Test Agent

GitHub Issue #{{issue_number}} のテストを実行します。

> **重要: 非対話的実行**
> このセッションはバックグラウンドで実行されます。
> **絶対にエディタを開くコマンドを使用しないでください**。
> 対話的なプロンプトが出るコマンドは使用しないでください。

> **🚫 禁止事項**
> - **`gh issue close` を絶対に実行しないでください**
> - **`gh pr create` はこのステップでは実行しないでください**（mergeステップで行います）
> - IssueのCloseはPRマージ時に `Closes #xxx` で自動的に行われます
> - このステップはワークフローの一部です。完了マーカーを出力すると次のステップに進みます

## コンテキスト

- **Issue番号**: #{{issue_number}}
- **タイトル**: {{issue_title}}
- **ブランチ**: {{branch_name}}
- **作業ディレクトリ**: {{worktree_path}}

## タスク

### 1. 単体テストを実行

プロジェクトに応じたテストコマンドを実行してください：

```bash
# プロジェクトタイプに応じたテストコマンド
# npm test, bats test/, pytest, cargo test など
```

### 2. 統合テストを実行（存在する場合）

統合テストが存在する場合は実行してください：

```bash
# 統合テストの実行
```

### 3. テスト結果を確認

テスト結果を分析し、以下を確認してください：
- すべてのテストがパスしているか
- エラーや警告がないか

### 4. カバレッジ確認（設定されている場合）

カバレッジレポートが生成される場合は確認してください：
- 新規追加コードにテストがあるか
- カバレッジ基準を満たしているか

## 実行コマンド例

プロジェクトに応じて以下のようなコマンドを実行してください：

```bash
# Node.jsプロジェクト
npm test

# Bashプロジェクト（Bats）
bats test/

# Pythonプロジェクト
pytest

# Rustプロジェクト
cargo test
```

## 完了条件

- [ ] すべてのテストがパスした
- [ ] 新規追加コードにテストがある
- [ ] カバレッジ基準を満たしている（設定されている場合）

## 完了後の動作

このステップ完了後、**次のステップに進んでください**。
完了マーカーはワークフロー全体（PRマージ後）の最後に出力します。

## コンテキスト保存（オプション）

タスク完了時または重要な学びがあった場合、以下のファイルを更新してください：

### Issue固有の学び
`.worktrees/.context/issues/{{issue_number}}.md`

### 保存すべき内容
- 試したアプローチと結果
- 発見した問題と解決策
- 今後の実行者への注意点

**注意**: これは推奨事項です。必須ではありません。

## エラー報告

回復不能なエラーが発生した場合は、以下の形式でエラーマーカーを出力してください：

- プレフィックス: `###TASK`
- 中間部: `_ERROR_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

上記を連結して**行頭から直接**1行で出力し、次の行にエラーの説明を記載してください。
（例: テストの実行に失敗しました）

> **重要**: このマーカーは外部プロセス（`watch-session.sh`）によって監視されています。
> マーカーは必ず行頭から出力してください。インデントやコードブロック内での出力は検出されません。

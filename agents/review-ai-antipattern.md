# Review: AI実装アンチパターン

`git diff origin/main` の変更を対象に、AI による実装特有の問題パターンをレビューします。

## コンテキスト

- **Issue番号**: #{{issue_number}}
- **ブランチ**: {{branch_name}}
- **作業ディレクトリ**: {{worktree_path}}

## 手順

### 1. 変更差分を取得

```bash
git diff origin/main --stat
git diff origin/main
```

### 2. Issue スコープの確認

```bash
gh issue view {{issue_number}} --json title,body -q '.title + "\n" + .body'
```

### 3. チェック項目

以下の観点で変更をレビューしてください：

- **存在しない API やオプションの使用**: 架空のコマンドオプション、存在しない関数呼び出し、誤った引数形式
- **ハルシネーション**: 架空のライブラリ、実在しない設定キー、ドキュメントに記載のない機能の使用
- **Issue スコープ外の変更（スコープクリープ）**: Issue の要件に無関係なファイルの変更、不要なリファクタリング
- **コメントが過剰で実装が薄い**: 説明コメントだけで実質的なロジックがない、TODO だらけの未完成コード
- **形だけのテスト**: アサーションが `true` のみ、実質的な検証を行っていないテスト、入力と期待値が同じテスト
- **既存コードとのスタイル不一致**: インデント、引用符、関数定義スタイルが周囲のコードと異なる
- **ファイルの意図しない上書き**: `write` や `>` による既存ファイルのスタブ化（数百行が数行に置き換え）

```bash
# 大幅に行数が減ったファイルを検出
git diff origin/main --numstat | awk '$2 > $1 * 5 && $2 > 50 {print "⚠️ 大幅削減:", $3, "(+" $1, "-" $2 ")"}'
```

### 4. 出力規約

問題なしの場合:
```
APPROVED
```

問題ありの場合:
```
## 指摘事項

### [重大度: HIGH] ファイル名:行番号
説明...

### [重大度: MEDIUM] ファイル名:行番号
説明...
```

- **HIGH**: 実行時に確実に失敗する問題（存在しないAPI、スコープ外の破壊的変更）
- **MEDIUM**: 品質に大きく影響する問題（形だけのテスト、スタイル不一致）
- **LOW**: 改善推奨（コメント過多、軽微なスコープ逸脱）

### 5. 修正

重大度 HIGH の指摘がある場合は、直接修正してコミットしてください。

```bash
git add -A
git commit -m "fix: レビュー指摘の修正（AIアンチパターン）"
```

## 完了条件

- [ ] 全変更差分をレビューした
- [ ] Issue スコープとの整合性を確認した
- [ ] HIGH の指摘があれば修正した
- [ ] 修正後にテストが通ることを確認した（修正した場合）

## 完了マーカー

レビュー完了後、以下のマーカーを出力してください：

- プレフィックス: `###TASK`
- 中間部: `_COMPLETE_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

上記を連結して**行頭から直接**1行で出力してください。

## エラー報告

回復不能なエラーが発生した場合：

```bash
mkdir -p "{{signal_dir}}" && echo "エラーの説明" > "{{signal_dir}}/signal-error-{{issue_number}}"
```

- プレフィックス: `###TASK`
- 中間部: `_ERROR_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

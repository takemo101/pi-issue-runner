# Review: セキュリティ

`git diff origin/main` の変更を対象に、セキュリティの観点からレビューします。

## コンテキスト

- **Issue番号**: #{{issue_number}}
- **ブランチ**: {{branch_name}}
- **作業ディレクトリ**: {{worktree_path}}

## 手順

### 1. 変更差分を取得

```bash
git diff origin/main --stat
git diff origin/main
```

### 2. チェック項目

以下の観点で変更をレビューしてください：

- **コマンドインジェクション**: `eval`、未サニタイズの変数を含むコマンド実行、`$()` 内での外部入力展開
- **パストラバーサル**: `..` を含むパスの未検証、シンボリックリンクの未チェック
- **機密情報のハードコード**: APIキー、パスワード、トークンの直接記述
- **認証・認可の漏れ**: 権限チェックのバイパス、デフォルト許可の設定
- **入力バリデーション不足**: Issue番号やセッション名の未サニタイズ、特殊文字（改行、タブ、引用符）の未処理
- **安全でない一時ファイル作成**: 予測可能なファイル名、`/tmp` 直下への競合リスク
- **権限の過剰付与**: 不要な `chmod 777`、過剰な環境変数エクスポート

### 3. 出力規約

問題なしの場合:
```
APPROVED
```

問題ありの場合:
```
## 指摘事項

### [重大度: HIGH] ファイル名:行番号
説明...

### [重大度: MEDIUM] ファイル名:行番号
説明...
```

- **HIGH**: 外部入力から直接悪用可能な脆弱性
- **MEDIUM**: 特定条件下で悪用可能な潜在的リスク
- **LOW**: セキュリティのベストプラクティスからの逸脱

### 4. 修正

重大度 HIGH の指摘がある場合は、直接修正してコミットしてください。

```bash
git add -A
git commit -m "fix: レビュー指摘の修正（セキュリティ）"
```

## 完了条件

- [ ] 全変更差分をレビューした
- [ ] HIGH の指摘があれば修正した
- [ ] 修正後にテストが通ることを確認した（修正した場合）

## 完了マーカー

レビュー完了後、以下のマーカーを出力してください：

- プレフィックス: `###TASK`
- 中間部: `_COMPLETE_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

上記を連結して**行頭から直接**1行で出力してください。

## エラー報告

回復不能なエラーが発生した場合：

```bash
mkdir -p "{{signal_dir}}" && echo "エラーの説明" > "{{signal_dir}}/signal-error-{{issue_number}}"
```

- プレフィックス: `###TASK`
- 中間部: `_ERROR_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

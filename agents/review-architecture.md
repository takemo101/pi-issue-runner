# Review: 設計・構造

`git diff origin/main` の変更を対象に、設計・構造の観点からレビューします。

## コンテキスト

- **Issue番号**: #{{issue_number}}
- **ブランチ**: {{branch_name}}
- **作業ディレクトリ**: {{worktree_path}}

## 手順

### 1. 変更差分を取得

```bash
git diff origin/main --stat
git diff origin/main
```

### 2. チェック項目

以下の観点で変更をレビューしてください：

- **単一責任の原則違反**: 1つの関数/ファイルが複数の異なる責務を持っていないか
- **循環依存**: source チェーンやモジュール間の参照が循環していないか
- **不適切な結合度**: 関数が他モジュールの内部実装に依存していないか、グローバル変数の乱用がないか
- **重複コード**: 同一・類似のロジックが複数箇所に存在しないか
- **インターフェースの一貫性**: 引数の順序、命名規則、戻り値の形式が既存コードと統一されているか
- **拡張性・保守性の問題**: ハードコードされた値、マジックナンバー、拡張困難な構造がないか
- **命名規約違反**: 関数名（小文字スネークケース）、変数名、ファイル名が規約に従っているか

### 3. 出力規約

問題なしの場合:
```
APPROVED
```

問題ありの場合:
```
## 指摘事項

### [重大度: HIGH] ファイル名:行番号
説明...

### [重大度: MEDIUM] ファイル名:行番号
説明...
```

- **HIGH**: アーキテクチャ上の根本的な問題（循環依存、重大な責務違反）
- **MEDIUM**: 保守性に影響する設計上の問題
- **LOW**: コードスタイルや命名の改善提案

### 4. 修正

重大度 HIGH の指摘がある場合は、直接修正してコミットしてください。

```bash
git add -A
git commit -m "refactor: レビュー指摘の修正（設計・構造）"
```

## 完了条件

- [ ] 全変更差分をレビューした
- [ ] HIGH の指摘があれば修正した
- [ ] 修正後にテストが通ることを確認した（修正した場合）

## 完了マーカー

レビュー完了後、以下のマーカーを出力してください：

- プレフィックス: `###TASK`
- 中間部: `_COMPLETE_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

上記を連結して**行頭から直接**1行で出力してください。

## エラー報告

回復不能なエラーが発生した場合：

```bash
mkdir -p "{{signal_dir}}" && echo "エラーの説明" > "{{signal_dir}}/signal-error-{{issue_number}}"
```

- プレフィックス: `###TASK`
- 中間部: `_ERROR_`
- Issue番号: `{{issue_number}}`
- サフィックス: `###`

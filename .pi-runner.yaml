# pi-issue-runner è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
# è©³ç´°: https://github.com/takemo101/pi-issue-runner/blob/main/docs/configuration.md

# =====================================
# Worktreeè¨­å®š
# =====================================
worktree:
  # worktreeã®ä½œæˆå…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
  base_dir: ".worktrees"

  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒï¼ˆ--base ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ä¸Šæ›¸ãå¯èƒ½ï¼‰
  base_branch: "origin/main"

  # worktreeä½œæˆæ™‚ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
  copy_files:
    - .env
    - .env.local
    - .envrc

  # worktreeä½œæˆæ™‚ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆå†å¸°ã‚³ãƒ”ãƒ¼ï¼‰
  copy_dirs:
    - .opencode

# =====================================
# ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µè¨­å®š
# =====================================
multiplexer:
  # ä½¿ç”¨ã™ã‚‹ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µ: tmux | zellij
  type: "tmux"

  # ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆä¾‹: pi-issue-42ï¼‰
  session_prefix: "pi"

  # ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§èµ·å‹•ã™ã‚‹ã‹
  start_in_session: true

# =====================================
# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
# =====================================
agent:
  # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¿ã‚¤ãƒ—: pi | claude | opencode | custom
  type: "pi"

  # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¸¡ã™è¿½åŠ å¼•æ•°
  args:
    - --provider
    - kimi-coding
    - --model
    - k2p5

# =====================================
# GitHubè¨­å®š
# =====================================
github:
  # Issueã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å«ã‚ã‚‹
  include_comments: true

  # æœ€å¤§ã‚³ãƒ¡ãƒ³ãƒˆæ•°ï¼ˆ0 = ç„¡åˆ¶é™ï¼‰
  max_comments: 10

# =====================================
# ä¸¦åˆ—å®Ÿè¡Œè¨­å®š
# =====================================
parallel:
  # åŒæ™‚å®Ÿè¡Œæ•°ã®ä¸Šé™ï¼ˆ0 = ç„¡åˆ¶é™ï¼‰
  max_concurrent: 5

# =====================================
# auto ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é¸æŠè¨­å®š
# =====================================
auto:
  provider: kimi-coding
  model: k2p5

# =====================================
# è¤‡æ•°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
# -w çœç•¥æ™‚ã¯ autoï¼ˆAIãŒIssueå†…å®¹ã‹ã‚‰è‡ªå‹•é¸æŠï¼‰
# =====================================
workflows:
  # æ¨™æº–: è¨ˆç”»â†’å®Ÿè£…â†’ãƒ¬ãƒ“ãƒ¥ãƒ¼â†’ãƒãƒ¼ã‚¸
  default:
    description: æ¨™æº–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆè¨ˆç”»ãƒ»å®Ÿè£…ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒãƒ¼ã‚¸ï¼‰
    steps:
      - plan:
          context: |
            å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
            è¤‡é›‘ãªå ´åˆã¯ designer ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å§”è­²ã—ã¦ãã ã•ã„ï¼š
            ```javascript
            subagent({ agent: "designer", task: "å®Ÿè£…è¨­è¨ˆã‚’ä½œæˆ" })
            ```
      - implement:
          context: |
            å®Ÿè£…ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
            
            è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å ´åˆã¯ä¸¦åˆ—å®Ÿè¡Œï¼š
            ```javascript
            subagent({
              tasks: [
                { agent: "implementer", task: "[ãƒ•ã‚¡ã‚¤ãƒ«1] ã‚’ä½œæˆ" },
                { agent: "implementer", task: "[ãƒ•ã‚¡ã‚¤ãƒ«2] ã‚’ä½œæˆ" }
              ]
            })
            ```
            
            å“è³ªãƒã‚§ãƒƒã‚¯ã‚‚ä¸¦åˆ—å®Ÿè¡Œï¼š
            ```javascript
            subagent({
              tasks: [
                { agent: "tester", task: "ShellCheckã¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ" },
                { agent: "reviewer", task: "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼" }
              ]
            })
            ```
      - review
      - merge

  # æ©Ÿèƒ½è¿½åŠ : è¨ˆç”»â†’å®Ÿè£…â†’ãƒ¬ãƒ“ãƒ¥ãƒ¼â†’ãƒãƒ¼ã‚¸
  feature:
    description: æ–°æ©Ÿèƒ½ãƒ»å¤§è¦æ¨¡å¤‰æ›´ï¼ˆlib/scripts ã¸ã®æ–°é–¢æ•°è¿½åŠ ã€æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆï¼‰
    steps:
      - plan:
          context: |
            å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
            è¤‡é›‘ãªå ´åˆã¯ designer ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å§”è­²ï¼š
            ```javascript
            subagent({ agent: "designer", task: "å®Ÿè£…è¨­è¨ˆã‚’ä½œæˆ" })
            ```
      - implement:
          context: |
            æ–°æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
            
            è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸¦åˆ—ä½œæˆï¼š
            ```javascript
            subagent({
              tasks: [
                { agent: "implementer", task: "lib/xxx.sh ã‚’ä½œæˆ" },
                { agent: "implementer", task: "lib/yyy.sh ã‚’ä½œæˆ" },
                { agent: "implementer", task: "scripts/zzz.sh ã‚’ä½œæˆ" },
                { agent: "tester", task: "ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ" }
              ]
            })
            ```
            
            å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆä¸¦åˆ—ï¼‰ï¼š
            ```javascript
            subagent({
              tasks: [
                { agent: "tester", task: "ShellCheckå®Ÿè¡Œ" },
                { agent: "tester", task: "Batsãƒ†ã‚¹ãƒˆå®Ÿè¡Œ" },
                { agent: "reviewer", task: "ã‚»ãƒ«ãƒ•ãƒ¬ãƒ“ãƒ¥ãƒ¼" }
              ]
            })
            ```
            
            ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼š
            ```javascript
            subagent({ agent: "librarian", task: "AGENTS.mdã‚’æ›´æ–°" })
            ```
      - review
      - merge
    context: |
      ## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
      - Bash 4.0+ / ShellCheck æº–æ‹ 
      - ãƒ†ã‚¹ãƒˆ: Bats (Bash Automated Testing System)
      - YAML: yq + ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç°¡æ˜“ãƒ‘ãƒ¼ã‚µãƒ¼ (lib/yaml.sh)

      ## æ–¹é‡
      - å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã« `set -euo pipefail` ã‚’è¨­å®š
      - é–¢æ•°ã¯å°æ–‡å­—ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã€ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã¯ `local` å®£è¨€

  # ãƒã‚°ä¿®æ­£ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
  fix:
    description: ãƒã‚°ä¿®æ­£ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿®æ­£
    steps:
      - implement:
          context: |
            ãƒã‚°ä¿®æ­£ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
            
            ä¿®æ­£å‰ã«å½±éŸ¿ç¯„å›²ã‚’ç¢ºèªï¼š
            ```javascript
            subagent({ agent: "explorer", task: "å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ã‚’èª¿æŸ»" })
            ```
            
            ä¿®æ­£å¾Œã®æ¤œè¨¼ï¼ˆä¸¦åˆ—ï¼‰ï¼š
            ```javascript
            subagent({
              tasks: [
                { agent: "tester", task: "ShellCheckå®Ÿè¡Œ" },
                { agent: "tester", task: "Batsãƒ†ã‚¹ãƒˆå®Ÿè¡Œ" }
              ]
            })
            ```
      - review
      - merge
    context: |
      ## æ–¹é‡
      - ä¿®æ­£ç¯„å›²ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹
      - å›å¸°ãƒ†ã‚¹ãƒˆã®è¿½åŠ ã‚’æ¤œè¨
      - ShellCheck è­¦å‘Šã‚’è§£æ¶ˆ
      - æ—¢å­˜æ©Ÿèƒ½ã®å¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒ

  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: å®Ÿè£…â†’ãƒãƒ¼ã‚¸ï¼ˆè»½é‡ãƒ¢ãƒ‡ãƒ«ã§ååˆ†ï¼‰
  docs:
    description: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼ˆREADME, AGENTS.md, docs/ ä»¥ä¸‹ï¼‰
    steps:
      - implement:
          context: |
            ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚
            å®Œäº†å¾Œã€librarian ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§æœ€çµ‚ç¢ºèªï¼š
            ```javascript
            subagent({ agent: "librarian", task: "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§ã‚’ç¢ºèª" })
            ```
      - merge

  # ãƒ†ã‚¹ãƒˆè¿½åŠ : å®Ÿè£…â†’ãƒ¬ãƒ“ãƒ¥ãƒ¼â†’ãƒãƒ¼ã‚¸
  test:
    description: ãƒ†ã‚¹ãƒˆè¿½åŠ ãƒ»ãƒ†ã‚¹ãƒˆæ”¹å–„
    steps:
      - implement:
          context: |
            ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ãƒ»æ”¹å–„ã—ã¦ãã ã•ã„ã€‚
            tester ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ç”¨ï¼š
            ```javascript
            subagent({
              tasks: [
                { agent: "tester", task: "ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ä½œæˆ" },
                { agent: "tester", task: "çµ±åˆãƒ†ã‚¹ãƒˆã‚’ä½œæˆ" },
                { agent: "tester", task: "å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦æ¤œè¨¼" }
              ]
            })
            ```
      - review
      - merge

  # ç°¡æ˜“ä¿®æ­£: å®Ÿè£…â†’ãƒãƒ¼ã‚¸ã®ã¿ï¼ˆè»½å¾®ãªå¤‰æ›´ï¼‰
  quickfix:
    description: typoä¿®æ­£ãƒ»è¨­å®šå€¤å¤‰æ›´ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆä¿®æ­£ãªã©è»½å¾®ãªå¤‰æ›´
    steps:
      - implement
      - merge

  # ã‚·ãƒ³ãƒ—ãƒ«: å®Ÿè£…â†’ãƒãƒ¼ã‚¸ï¼ˆãƒ†ã‚¹ãƒˆãªã—ã€æœ€é€Ÿï¼‰
  simple:
    description: æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆå®Ÿè£…ã®ã¿ï¼‰
    steps:
      - implement
      - merge

# =====================================
# è¨ˆç”»æ›¸è¨­å®š
# =====================================
plans:
  # ä¿æŒã™ã‚‹è¨ˆç”»æ›¸ã®ä»¶æ•°ï¼ˆ0 = å…¨ã¦ä¿æŒï¼‰
  keep_recent: 10

  # è¨ˆç”»æ›¸ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
  dir: "docs/plans"

# =====================================
# improve è¨­å®š
# =====================================
improve:
  # ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
  review_prompt_file: "agents/improve-review.md"

  # ãƒ­ã‚°è¨­å®š
  logs:
    keep_recent: 10
    keep_days: 7
    dir: ".improve-logs"

# =====================================
# Hookè¨­å®š
# =====================================
hooks:
  # ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã‚’è¨±å¯ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰
  allow_inline: true

  # æˆåŠŸæ™‚ã®é€šçŸ¥
  on_success: |
    osascript -e 'display notification "Issue #'"$PI_ISSUE_NUMBER"' ãŒå®Œäº†ã—ã¾ã—ãŸ" with title "Pi Issue Runner" subtitle "âœ… å®Œäº†" sound name "Glass"'

  # ã‚¨ãƒ©ãƒ¼æ™‚ã®é€šçŸ¥
  on_error: |
    osascript -e 'display notification "'"$PI_ERROR_MESSAGE"'" with title "Pi Issue Runner" subtitle "âŒ Issue #'"$PI_ISSUE_NUMBER"' ã‚¨ãƒ©ãƒ¼" sound name "Basso"'

  # ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚
  on_start: |
    osascript -e 'display notification "Issue #'"$PI_ISSUE_NUMBER"' ã‚’é–‹å§‹ã—ã¾ã—ãŸ" with title "Pi Issue Runner" subtitle "ğŸš€ é–‹å§‹" sound name "Pop"'

  # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å¾Œ
  on_cleanup: |
    echo "Cleanup completed for Issue #$PI_ISSUE_NUMBER"

  # improveé–‹å§‹æ™‚
  on_improve_start: |
    osascript -e 'display notification "æ”¹å–„ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹ã—ã¾ã™ï¼ˆæœ€å¤§ '"$PI_MAX_ITERATIONS"' å›ï¼‰" with title "Pi Issue Runner" subtitle "ğŸ”„ improveé–‹å§‹" sound name "Pop"'

  # improveçµ‚äº†æ™‚
  on_improve_end: |
    osascript -e 'display notification "æ”¹å–„ãƒ«ãƒ¼ãƒ—å®Œäº†: ä½œæˆ '"$PI_ISSUES_CREATED"' / æˆåŠŸ '"$PI_ISSUES_SUCCEEDED"' / å¤±æ•— '"$PI_ISSUES_FAILED"'" with title "Pi Issue Runner" subtitle "ğŸ improveçµ‚äº†" sound name "Glass"'

  # ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹æ™‚
  on_iteration_start: |
    osascript -e 'display notification "ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ '"$PI_ITERATION"'/'"$PI_MAX_ITERATIONS"' ã‚’é–‹å§‹" with title "Pi Issue Runner" subtitle "ğŸ” ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹" sound name "Pop"'

  # ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†æ™‚
  on_iteration_end: |
    osascript -e 'display notification "ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ '"$PI_ITERATION"'/'"$PI_MAX_ITERATIONS"' å®Œäº†: æˆåŠŸ '"$PI_ISSUES_SUCCEEDED"' / å¤±æ•— '"$PI_ISSUES_FAILED"'" with title "Pi Issue Runner" subtitle "âœ… ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†" sound name "Purr"'

  # ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†æ™‚
  on_review_complete: |
    osascript -e 'display notification "ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†: '"$PI_REVIEW_ISSUES_COUNT"' ä»¶ã®å•é¡Œã‚’ç™ºè¦‹" with title "Pi Issue Runner" subtitle "ğŸ” ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†" sound name "Tink"'

# =====================================
# Watcherè¨­å®š
# =====================================
watcher:
  # PRãƒãƒ¼ã‚¸ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã«å¼·åˆ¶ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  force_cleanup_on_timeout: true

  # ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥æ™‚ã«ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’è‡ªå‹•ã§é–‹ã„ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹
  auto_attach: false

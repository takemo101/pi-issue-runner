# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

Pi Issue Runnerã¯ `.pi-runner.yaml` ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `.pi-runner.yaml` ã‚’é…ç½®ã—ã¾ã™ã€‚

```
my-project/
â”œâ”€â”€ .pi-runner.yaml    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ src/
â””â”€â”€ ...
```

## å®Œå…¨ãªè¨­å®šä¾‹

```yaml
# .pi-runner.yaml

# =====================================
# Worktreeè¨­å®š
# =====================================
worktree:
  # worktreeã®ä½œæˆå…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: .worktrees
  base_dir: .worktrees
  
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒ
  # --base ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ä¸Šæ›¸ãå¯èƒ½
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: HEAD
  base_branch: origin/develop
  
  # worktreeä½œæˆæ™‚ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: .env .env.local .envrc
  copy_files:
    - .env
    - .env.local
    - .envrc
    - config/database.yml    # ä¾‹: Railsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆ
    - config/secrets.yml     # ä¾‹: Railsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆ

# =====================================
# ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µè¨­å®š
# =====================================
multiplexer:
  # ä½¿ç”¨ã™ã‚‹ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µ
  # tmux ã¾ãŸã¯ zellij
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: tmux
  type: tmux
  
  # ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹
  # å®Ÿéš›ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³å: {prefix}-issue-{number}
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: pi
  session_prefix: pi
  
  # ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§èµ·å‹•ã™ã‚‹ã‹
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true
  start_in_session: true

# =====================================
# piã‚³ãƒãƒ³ãƒ‰è¨­å®šï¼ˆå¾“æ¥ã®è¨­å®šã€å¾Œæ–¹äº’æ›æ€§ã‚ã‚Šï¼‰
# =====================================
pi:
  # piã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: pi
  command: pi
  
  # piã«æ¸¡ã™è¿½åŠ å¼•æ•°
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: (ãªã—)
  args:
    - --model
    - claude-sonnet-4-20250514

# =====================================
# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šï¼ˆè¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå¯¾å¿œï¼‰
# =====================================
agent:
  # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆ: pi, claude, opencode, custom
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: piï¼ˆagentæœªè¨­å®šæ™‚ã¯pi.commandã‚’ä½¿ç”¨ï¼‰
  type: pi
  
  # ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ï¼ˆtype: customã®å ´åˆã«ä½¿ç”¨ï¼‰
  # command: my-agent
  
  # è¿½åŠ å¼•æ•°
  # args:
  #   - --verbose
  
  # ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆtype: customã®å ´åˆã«ä½¿ç”¨ï¼‰
  # template: '{{command}} {{args}} --file "{{prompt_file}}"'

# =====================================
# ä¸¦åˆ—å®Ÿè¡Œè¨­å®š
# =====================================
parallel:
  # åŒæ™‚å®Ÿè¡Œæ•°ã®ä¸Šé™
  # 0 = ç„¡åˆ¶é™
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0
  max_concurrent: 3

# =====================================
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ - éæ¨å¥¨: workflows.default ã‚’æ¨å¥¨
# =====================================
# NOTE: workflow:ï¼ˆå˜æ•°å½¢ï¼‰ã¯å¾Œæ–¹äº’æ›ã®ãŸã‚ã«æ®‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
# æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ workflows.default ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
# workflow:
#   # å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
#   # ãƒ“ãƒ«ãƒˆã‚¤ãƒ³: plan, implement, test, review, merge, ci-fix
#   # ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã‚‚å®šç¾©å¯èƒ½ï¼ˆå¯¾å¿œã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå¿…è¦ï¼‰
#   steps:
#     - plan
#     - implement
#     - test
#     - review
#     - merge

# =====================================
# åå‰ä»˜ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®šï¼ˆè¤‡æ•°å®šç¾©ï¼‰
# =====================================
# æ³¨: -w NAME ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§é¸æŠã€ã¾ãŸã¯ -w auto ã§ AI ãŒè‡ªå‹•é¸æŠ
workflows:
  # å°è¦æ¨¡ãƒã‚°ä¿®æ­£å‘ã‘
  quick:
    description: å°è¦æ¨¡ä¿®æ­£ï¼ˆtypoã€è¨­å®šå¤‰æ›´ã€1ãƒ•ã‚¡ã‚¤ãƒ«ç¨‹åº¦ã®å¤‰æ›´ï¼‰
    steps:
      - implement
      - merge
  
  # å¤§è¦æ¨¡æ©Ÿèƒ½é–‹ç™ºå‘ã‘
  thorough:
    description: å¤§è¦æ¨¡æ©Ÿèƒ½é–‹ç™ºï¼ˆè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã€æ–°æ©Ÿèƒ½ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´ï¼‰
    steps:
      - plan
      - implement
      - test
      - review
      - merge
  
  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…å‘ã‘ï¼ˆcontext ä»˜ãï¼‰
  frontend:
    description: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆReact/Next.jsã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã€ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
    steps:
      - plan
      - implement
      - review
      - merge
    context: |
      ## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
      - React / Next.js / TypeScript
      - TailwindCSS
      
      ## é‡è¦–ã™ã¹ãç‚¹
      - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
      - ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ (WCAG 2.1 AA)
      - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†åˆ©ç”¨æ€§
      - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆCore Web Vitalsï¼‰
  
  # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…å‘ã‘ï¼ˆcontext ä»˜ãï¼‰
  backend:
    description: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå®Ÿè£…ï¼ˆDBæ“ä½œã€èªè¨¼ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‡¦ç†ï¼‰
    steps:
      - plan
      - implement
      - test
      - review
      - merge
    context: |
      ## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
      - Node.js / Express / TypeScript
      - PostgreSQL / Prisma
      
      ## é‡è¦–ã™ã¹ãç‚¹
      - RESTful APIè¨­è¨ˆ
      - å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ã‚°
      - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆã®å……å®Ÿ
  
  # è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆå‘ã‘ï¼ˆã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
  design:
    description: è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆï¼ˆæŠ€è¡“èª¿æŸ»ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆã€ADRã€ä»•æ§˜æ›¸ï¼‰
    steps:
      - research  # ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆagents/research.md ãŒå¿…è¦ï¼‰
      - design    # ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆagents/design.md ãŒå¿…è¦ï¼‰
      - review
      - merge
    context: |
      ## ç›®çš„
      ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã§ã¯ãªãã€è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½œæˆã«ç‰¹åŒ–ã™ã‚‹ã€‚
      
      ## æˆæœç‰©
      - docs/ ä»¥ä¸‹ã« Markdown ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆ
      - ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯åŸå‰‡è¡Œã‚ãªã„
      
      ## é‡è¦–ã™ã¹ãç‚¹
      - èƒŒæ™¯ãƒ»èª²é¡Œãƒ»ä»£æ›¿æ¡ˆã®æ˜è¨˜
      - å›³ã‚„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ã£ãŸå¯è¦–åŒ–
      - å°†æ¥ã®æ‹¡å¼µæ€§ã¸ã®è¨€åŠ
      - æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã®æ•´åˆæ€§
  
  # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å›ºæœ‰ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šï¼ˆagent ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ï¼‰
  quick-haiku:
    description: å°è¦æ¨¡ä¿®æ­£ï¼ˆé«˜é€Ÿãƒ»ä½ã‚³ã‚¹ãƒˆï¼‰
    steps:
      - implement
      - merge
    agent:
      type: pi
      args:
        - --model
        - claude-haiku-4-5  # è»½é‡ãƒ¢ãƒ‡ãƒ«
  
  thorough-opus:
    description: å¾¹åº•ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆé«˜ç²¾åº¦ï¼‰
    steps:
      - plan
      - implement
      - test
      - review
      - merge
    agent:
      type: claude
      args:
        - --model
        - claude-opus-4  # æœ€é«˜ç²¾åº¦ãƒ¢ãƒ‡ãƒ«

# =====================================
# auto ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é¸æŠè¨­å®š
# =====================================
# `-w auto` ã§ AI ãŒ workflows ã‹ã‚‰è‡ªå‹•é¸æŠã™ã‚‹éš›ã®è¨­å®š
auto:
  # AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: agentè¨­å®šã‹ã‚‰æ¨å®š or anthropic
  provider: anthropic
  
  # AIãƒ¢ãƒ‡ãƒ«ï¼ˆè»½é‡ãƒ»é«˜é€Ÿãªãƒ¢ãƒ‡ãƒ«æ¨å¥¨ï¼‰
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: claude-haiku-4-5
  model: claude-haiku-4-5

# =====================================
# è¨ˆç”»æ›¸è¨­å®š
# =====================================
plans:
  # ä¿æŒã™ã‚‹è¨ˆç”»æ›¸ã®ä»¶æ•°ï¼ˆ0 = å…¨ã¦ä¿æŒï¼‰
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10
  keep_recent: 10
  
  # è¨ˆç”»æ›¸ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: docs/plans
  dir: "docs/plans"

# =====================================
# improve è¨­å®š
# =====================================
improve:
  # ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆçœç•¥æ™‚ã¯è‡ªå‹•æ¤œç´¢ï¼‰
  # æ¤œç´¢é †: agents/improve-review.md â†’ .pi/agents/improve-review.md â†’ ãƒ“ãƒ«ãƒˆã‚¤ãƒ³
  # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°: {{max_issues}}, {{session_label}}, {{review_context}}
  review_prompt_file: "agents/improve-review.md"

  # ãƒ­ã‚°è¨­å®š
  logs:
    # ä¿æŒã™ã‚‹ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä»¶æ•°ï¼ˆ0 = å…¨ã¦ä¿æŒï¼‰
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10
    keep_recent: 10
    
    # ä¿æŒã™ã‚‹ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ—¥æ•°ï¼ˆ0 = æ—¥æ•°åˆ¶é™ãªã—ï¼‰
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 7
    keep_days: 7
    
    # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: .improve-logs
    dir: ".improve-logs"

# NOTE: æ—§å½¢å¼ improve_logs: ã‚‚å¾Œæ–¹äº’æ›ã§å¼•ãç¶šãã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã™

# =====================================
# Trackerè¨­å®šï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåŠ¹æœæ¸¬å®šï¼‰
# =====================================
tracker:
  # ãƒˆãƒ©ãƒƒã‚«ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: .worktrees/.status/tracker.jsonl
  file: ".worktrees/.status/tracker.jsonl"

# =====================================
# GitHubè¨­å®š
# =====================================
github:
  # Issueã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å«ã‚ã‚‹ã‹
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true
  include_comments: true
  
  # å«ã‚ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã®ä¸Šé™
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10
  max_comments: 10

# =====================================
# Hookè¨­å®š
# =====================================
hooks:
  # ã‚¿ã‚¹ã‚¯é–‹å§‹æ™‚
  on_start: ""
  # æˆåŠŸæ™‚
  on_success: ""
  # ã‚¨ãƒ©ãƒ¼æ™‚
  on_error: ""
  # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ™‚
  on_cleanup: ""
  # improveé–‹å§‹æ™‚
  on_improve_start: ""
  # improveçµ‚äº†æ™‚
  on_improve_end: ""
  # ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹æ™‚
  on_iteration_start: ""
  # ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†æ™‚
  on_iteration_end: ""
  # ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†æ™‚
  on_review_complete: ""

# =====================================
# Watcherè¨­å®š
# =====================================
watcher:
  # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç›£è¦–ã®åˆæœŸé…å»¶ï¼ˆç§’ï¼‰
  # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹æ™‚é–“
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10
  initial_delay: 10
  
  # cleanupå®Ÿè¡Œå‰ã®å¾…æ©Ÿæ™‚é–“ï¼ˆç§’ï¼‰
  # ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã€worktreeå‰Šé™¤å‰ã«å¾…æ©Ÿã™ã‚‹
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5
  cleanup_delay: 5
  
  # cleanupãƒªãƒˆãƒ©ã‚¤é–“éš”ï¼ˆç§’ï¼‰
  # cleanupå¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤é–“éš”
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3
  cleanup_retry_interval: 3
  
  # PRãƒãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯ã®æœ€å¤§è©¦è¡Œå›æ•°
  # å®Œäº†ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºå¾Œã€PRãŒãƒãƒ¼ã‚¸ã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹å›æ•°
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10
  pr_merge_max_attempts: 10
  
  # PRãƒãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯é–“éš”ï¼ˆç§’ï¼‰
  # å„ãƒã‚§ãƒƒã‚¯é–“ã®å¾…æ©Ÿæ™‚é–“
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 60
  pr_merge_retry_interval: 60

  # PRãƒãƒ¼ã‚¸ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã«å¼·åˆ¶ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  # true ã«ã™ã‚‹ã¨ã€PRãŒè¦‹ã¤ã‹ã‚‰ãªã„/ãƒãƒ¼ã‚¸ã•ã‚Œãªã„å ´åˆã§ã‚‚
  # å®Œäº†ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºå¾Œã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼·åˆ¶çµ‚äº†ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: false
  force_cleanup_on_timeout: false

# =====================================
# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
# =====================================
agents:
  # å„ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
  plan: agents/plan.md
  implement: agents/implement.md
  review: agents/review.md
  merge: agents/merge.md
  test: agents/test.md
  ci-fix: agents/ci-fix.md
```

## è¨­å®šé …ç›®è©³ç´°

### worktree

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `base_dir` | string | `.worktrees` | worktreeã®ä½œæˆå…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |
| `base_branch` | string | `HEAD` | worktreeä½œæˆæ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒï¼ˆ`--base`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ä¸Šæ›¸ãå¯èƒ½ï¼‰ |
| `copy_files` | string[] | `.env .env.local .envrc` | worktreeä½œæˆæ™‚ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« |

#### copy_filesã®ä½¿ã„æ–¹

ç’°å¢ƒå›ºæœ‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.envç­‰ï¼‰ã¯Gitç®¡ç†å¤–ã®ãŸã‚ã€worktreeä½œæˆæ™‚ã«ã‚³ãƒ”ãƒ¼ãŒå¿…è¦ã§ã™ã€‚

```yaml
worktree:
  copy_files:
    - .env                    # ç’°å¢ƒå¤‰æ•°
    - .env.local              # ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒå¤‰æ•°
    - config/master.key       # Railsãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼
    - .npmrc                  # npmèªè¨¼æƒ…å ±
```

### multiplexer

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `type` | string | `tmux` | ä½¿ç”¨ã™ã‚‹ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µï¼ˆ`tmux` ã¾ãŸã¯ `zellij`ï¼‰ |
| `session_prefix` | string | `pi` | ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ |
| `start_in_session` | boolean | `true` | ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§èµ·å‹•ã™ã‚‹ã‹ |

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®å½¢å¼

```
{session_prefix}-issue-{issue_number}
```

ä¾‹: `pi-issue-42`

#### Zellijã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```yaml
multiplexer:
  type: zellij
  session_prefix: my-project
```

ç’°å¢ƒå¤‰æ•°ã§ã‚‚åˆ‡ã‚Šæ›¿ãˆå¯èƒ½:
```bash
PI_RUNNER_MULTIPLEXER_TYPE=zellij pi-run 42
PI_RUNNER_MULTIPLEXER_SESSION_PREFIX=my-project pi-run 42
```

### pi

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `command` | string | `pi` | piã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹ |
| `args` | string[] | (ãªã—) | piã«æ¸¡ã™è¿½åŠ å¼•æ•° |

#### argsã®ä½¿ã„æ–¹

```yaml
pi:
  command: /usr/local/bin/pi
  args:
    - --model
    - claude-sonnet-4-20250514
    - --dangerously-skip-permissions
```

### agent

> **æ–°æ©Ÿèƒ½**: è¤‡æ•°ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«å¯¾å¿œã—ã¾ã—ãŸã€‚

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `type` | string | (ãªã—) | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆpi, claude, opencode, customï¼‰ |
| `command` | string | (ãƒ—ãƒªã‚»ãƒƒãƒˆã«ã‚ˆã‚‹) | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹ |
| `args` | string[] | (ãªã—) | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¸¡ã™è¿½åŠ å¼•æ•° |
| `template` | string | (ãƒ—ãƒªã‚»ãƒƒãƒˆã«ã‚ˆã‚‹) | ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |

#### ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒ—ãƒªã‚»ãƒƒãƒˆ

| ãƒ—ãƒªã‚»ãƒƒãƒˆ | ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|-----------|---------|------|
| `pi` | `pi @"prompt.md"` | Pi coding agentï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |
| `claude` | `claude --print "prompt.md"` | Claude Code |
| `opencode` | `cat prompt.md \| opencode` | OpenCode (stdinçµŒç”±) |
| `custom` | (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã‚ˆã‚‹) | ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ |

#### ä½¿ç”¨ä¾‹

```yaml
# Claude Codeã‚’ä½¿ç”¨
agent:
  type: claude

# OpenCodeã‚’ä½¿ç”¨
agent:
  type: opencode

# ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ç”¨
agent:
  type: custom
  command: my-agent
  template: '{{command}} {{args}} --file "{{prompt_file}}"'
```

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°

ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä½¿ç”¨å¯èƒ½ãªå¤‰æ•°ã«ã¤ã„ã¦ã¯ã€[ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](#ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒãƒ³ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯ä»¥ä¸‹ã®å¤‰æ•°ãŒä½¿ç”¨ã§ãã¾ã™ï¼š
- `{{command}}` - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒãƒ³ãƒ‰
- `{{args}}` - å¼•æ•°ï¼ˆagent.args + --agent-argsï¼‰
- `{{prompt_file}}` - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

#### å¾Œæ–¹äº’æ›æ€§

`agent` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒæœªè¨­å®šã®å ´åˆã€`pi` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¨­å®šãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
æ—¢å­˜ã®è¨­å®šã¯ãã®ã¾ã¾å‹•ä½œã—ã¾ã™ã€‚

```yaml
# å¾“æ¥ã®è¨­å®šï¼ˆå¼•ãç¶šãå‹•ä½œï¼‰
pi:
  command: pi
  args:
    - --model
    - claude-sonnet-4-20250514
```

#### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã”ã¨ã®agentè¨­å®š

> **æ–°æ©Ÿèƒ½**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã”ã¨ã«ç•°ãªã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©å†…ã§ `agent` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹éš›ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªagentè¨­å®šã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã§ãã¾ã™ã€‚

| ã‚­ãƒ¼ | å‹ | èª¬æ˜ |
|------|------|------|
| `workflows.<name>.agent.type` | string | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆpi, claude, opencode, customï¼‰ |
| `workflows.<name>.agent.command` | string | ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒãƒ³ãƒ‰ |
| `workflows.<name>.agent.args` | string[] | è¿½åŠ å¼•æ•° |
| `workflows.<name>.agent.template` | string | ã‚³ãƒãƒ³ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |

**ä½¿ç”¨ä¾‹**:

```yaml
# ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
agent:
  type: pi
  args:
    - --model
    - claude-sonnet-4

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã”ã¨ã®agentè¨­å®š
workflows:
  # å°è¦æ¨¡ä¿®æ­£: é«˜é€Ÿãƒ»ä½ã‚³ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«
  quick:
    description: å°è¦æ¨¡ä¿®æ­£ï¼ˆtypoã€è¨­å®šå¤‰æ›´ç­‰ï¼‰
    steps: [implement, merge]
    agent:
      type: pi
      args:
        - --model
        - claude-haiku-4-5  # è»½é‡ãƒ¢ãƒ‡ãƒ«ã§ã‚³ã‚¹ãƒˆå‰Šæ¸›
  
  # å¾¹åº•ãƒ¬ãƒ“ãƒ¥ãƒ¼: æœ€é«˜ç²¾åº¦ãƒ¢ãƒ‡ãƒ«
  thorough:
    description: å¤§è¦æ¨¡æ©Ÿèƒ½é–‹ç™º
    steps: [plan, implement, test, review, merge]
    agent:
      type: claude
      args:
        - --model
        - claude-opus-4  # æœ€é«˜ç²¾åº¦ã§ãƒã‚°ã‚’å‰Šæ¸›
  
  # ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
  experimental:
    description: å®Ÿé¨“çš„æ©Ÿèƒ½é–‹ç™º
    steps: [implement, review, merge]
    agent:
      type: custom
      command: my-experimental-agent
      template: '{{command}} {{args}} --input "{{prompt_file}}"'
```

**ä½¿ã„æ–¹**:

```bash
# quick ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œï¼ˆclaude-haiku-4-5ã‚’ä½¿ç”¨ï¼‰
./scripts/run.sh 42 -w quick

# thorough ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œï¼ˆclaude-opus-4ã‚’ä½¿ç”¨ï¼‰
./scripts/run.sh 42 -w thorough

# agentæœªæŒ‡å®šã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã‚’ä½¿ç”¨
./scripts/run.sh 42 -w simple  # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®agentè¨­å®šã‚’ä½¿ç”¨
```

**è¨­å®šã®å„ªå…ˆé †ä½**:

1. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å›ºæœ‰ã® `workflows.<name>.agent` è¨­å®š
2. ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª `agent` è¨­å®š
3. å¾“æ¥ã® `pi` è¨­å®šï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

### parallel

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `max_concurrent` | integer | `0` | åŒæ™‚å®Ÿè¡Œæ•°ã®ä¸Šé™ï¼ˆ0=ç„¡åˆ¶é™ï¼‰ |

#### ä¸¦åˆ—å®Ÿè¡Œã®åˆ¶å¾¡

```yaml
# CPUã‚³ã‚¢æ•°ã«åˆã‚ã›ã¦åˆ¶é™
parallel:
  max_concurrent: 4

# ç„¡åˆ¶é™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
parallel:
  max_concurrent: 0
```

### plans

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `keep_recent` | integer | `10` | ä¿æŒã™ã‚‹è¨ˆç”»æ›¸ã®ä»¶æ•°ï¼ˆ0 = å…¨ã¦ä¿æŒï¼‰ |
| `dir` | string | `docs/plans` | è¨ˆç”»æ›¸ã®ä¿å­˜å…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |

#### è¨ˆç”»æ›¸ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

è¨ˆç”»æ›¸ã¯è‡ªå‹•çš„ã«ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã€å¤ã„è¨ˆç”»æ›¸ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚

```yaml
# æœ€æ–°20ä»¶ã®è¨ˆç”»æ›¸ã®ã¿ä¿æŒ
plans:
  keep_recent: 20
  dir: "docs/plans"

# å…¨ã¦ã®è¨ˆç”»æ›¸ã‚’ä¿æŒï¼ˆè‡ªå‹•å‰Šé™¤ç„¡åŠ¹ï¼‰
plans:
  keep_recent: 0
```

#### è¨ˆç”»æ›¸ã®ä¿å­˜å ´æ‰€

è¨ˆç”»æ›¸ã¯ `{dir}/issue-{number}-plan.md` ã¨ã„ã†å‘½åè¦å‰‡ã§ä¿å­˜ã•ã‚Œã¾ã™ã€‚

```
docs/plans/
â”œâ”€â”€ issue-42-plan.md
â”œâ”€â”€ issue-43-plan.md
â””â”€â”€ issue-44-plan.md
```

### improve

`improve.sh` ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒ­ã‚°è¨­å®š

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `review_prompt_file` | string | (è‡ªå‹•æ¤œç´¢) | ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ |
| `logs.keep_recent` | integer | `10` | ç›´è¿‘ä½•ä»¶ã®ãƒ­ã‚°ã‚’ä¿æŒã™ã‚‹ã‹ï¼ˆ0 = å…¨ã¦ä¿æŒï¼‰ |
| `logs.keep_days` | integer | `7` | ä½•æ—¥ä»¥å†…ã®ãƒ­ã‚°ã‚’ä¿æŒã™ã‚‹ã‹ï¼ˆ0 = æ—¥æ•°åˆ¶é™ãªã—ï¼‰ |
| `logs.dir` | string | `.improve-logs` | ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |

> **å¾Œæ–¹äº’æ›**: æ—§å½¢å¼ `improve_logs:` ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚

### watcher

ã‚»ãƒƒã‚·ãƒ§ãƒ³ç›£è¦–ï¼ˆ`watch-session.sh`ï¼‰ã®å‹•ä½œè¨­å®š

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `initial_delay` | integer | `10` | ã‚»ãƒƒã‚·ãƒ§ãƒ³ç›£è¦–é–‹å§‹å‰ã®åˆæœŸé…å»¶ï¼ˆç§’ï¼‰ |
| `cleanup_delay` | integer | `5` | cleanupå®Ÿè¡Œå‰ã®å¾…æ©Ÿæ™‚é–“ï¼ˆç§’ï¼‰ |
| `cleanup_retry_interval` | integer | `3` | cleanupãƒªãƒˆãƒ©ã‚¤é–“éš”ï¼ˆç§’ï¼‰ |
| `pr_merge_max_attempts` | integer | `10` | PRãƒãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯ã®æœ€å¤§è©¦è¡Œå›æ•° |
| `pr_merge_retry_interval` | integer | `60` | PRãƒãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯ã®ãƒªãƒˆãƒ©ã‚¤é–“éš”ï¼ˆç§’ï¼‰ |
| `force_cleanup_on_timeout` | boolean | `false` | PRãƒãƒ¼ã‚¸ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã«å¼·åˆ¶ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œã™ã‚‹ |

#### ã‚¿ã‚¤ãƒŸãƒ³ã‚°èª¿æ•´ã®æŒ‡é‡

ã“ã‚Œã‚‰ã®è¨­å®šå€¤ã¯ç’°å¢ƒã‚„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¿œã˜ã¦èª¿æ•´ã§ãã¾ã™ï¼š

**é«˜é€Ÿç’°å¢ƒï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼‰**:
```yaml
watcher:
  initial_delay: 5           # é«˜é€Ÿèµ·å‹•æ™‚ã¯çŸ­ç¸®å¯èƒ½
  cleanup_delay: 3           # ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ãŒæ—©ã„
  pr_merge_max_attempts: 5   # é«˜é€Ÿãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã¯å°‘ãªã‚ã§OK
```

**ä½é€Ÿç’°å¢ƒï¼ˆCIã€é«˜è² è·ã‚µãƒ¼ãƒãƒ¼ï¼‰**:
```yaml
watcher:
  initial_delay: 15          # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤ºã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆ
  cleanup_delay: 10          # ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ã«ä½™è£•ã‚’æŒãŸã›ã‚‹
  pr_merge_max_attempts: 20  # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã‚’è€ƒæ…®
  pr_merge_retry_interval: 120  # ãƒã‚§ãƒƒã‚¯é–“éš”ã‚’é•·ã‚ã«
```

**ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®è¨ˆç®—**:
PR merge ãƒã‚§ãƒƒã‚¯ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã¯ä»¥ä¸‹ã®å¼ã§è¨ˆç®—ã•ã‚Œã¾ã™ï¼š
```
ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ = pr_merge_max_attempts Ã— pr_merge_retry_interval
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `10 Ã— 60 = 600ç§’ï¼ˆ10åˆ†ï¼‰`

#### ä½¿ç”¨ä¾‹

```yaml
# .pi-runner.yaml
watcher:
  # é«˜é€Ÿç’°å¢ƒå‘ã‘ã®è¨­å®š
  initial_delay: 5
  cleanup_delay: 3
  cleanup_retry_interval: 2
  pr_merge_max_attempts: 10
  pr_merge_retry_interval: 60
```

ç’°å¢ƒå¤‰æ•°ã§ã‚‚è¨­å®šå¯èƒ½ï¼š
```bash
# åˆæœŸé…å»¶ã‚’15ç§’ã«å¤‰æ›´
PI_RUNNER_WATCHER_INITIAL_DELAY=15 ./scripts/run.sh 42

# PRãƒãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯ã‚’20åˆ†ã«å»¶é•·
PI_RUNNER_WATCHER_PR_MERGE_MAX_ATTEMPTS=20 \
PI_RUNNER_WATCHER_PR_MERGE_RETRY_INTERVAL=60 \
./scripts/run.sh 42
```

#### ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

`improve.sh` ãŒç”Ÿæˆã™ã‚‹ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€è¨­å®šã«åŸºã¥ã„ã¦è‡ªå‹•çš„ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã§ãã¾ã™ã€‚

```yaml
# æœ€æ–°10ä»¶ã‹ã¤7æ—¥ä»¥å†…ã®ãƒ­ã‚°ã‚’ä¿æŒ
improve:
  logs:
    keep_recent: 10
    keep_days: 7
    dir: .improve-logs

# å…¨ã¦ã®ãƒ­ã‚°ã‚’ä¿æŒï¼ˆè‡ªå‹•å‰Šé™¤ç„¡åŠ¹ï¼‰
improve:
  logs:
    keep_recent: 0
    keep_days: 0
```

> **å¾Œæ–¹äº’æ›**: æ—§å½¢å¼ `improve_logs:` ã‚‚å¼•ãç¶šãå‹•ä½œã—ã¾ã™ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
# è¨­å®šã«å¾“ã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
./scripts/cleanup.sh --improve-logs

# ç‰¹å®šã®æ—¥æ•°ã§ä¸Šæ›¸ãï¼ˆ7æ—¥ä»¥ä¸Šå‰ã®ãƒ­ã‚°ã‚’å‰Šé™¤ï¼‰
./scripts/cleanup.sh --improve-logs --age 7

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆå‰Šé™¤ã›ãšã«å¯¾è±¡ã‚’è¡¨ç¤ºï¼‰
./scripts/cleanup.sh --improve-logs --dry-run

# å…¨ã¦ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆimprove-logsã‚‚å«ã‚€ï¼‰
./scripts/cleanup.sh --all
```

#### å‰Šé™¤æ¡ä»¶

ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®æ¡ä»¶ã§å‰Šé™¤ã•ã‚Œã¾ã™ï¼š

- **keep_recent**: æ›´æ–°æ—¥æ™‚ã®æ–°ã—ã„é †ã«ä¸¦ã¹ã¦ã€Nä»¶ã‚’è¶…ãˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
- **keep_days**: Næ—¥ã‚ˆã‚Šå¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
- ä¸¡æ–¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã„ãšã‚Œã‹ã®æ¡ä»¶ã«è©²å½“ã™ã‚‹ã¨å‰Šé™¤

**ä¾‹**: `keep_recent: 10, keep_days: 7` ã®å ´åˆ
- æœ€æ–°10ä»¶ã®ãƒ­ã‚°ã¯ä¿æŒï¼ˆæ—¥æ™‚ã«ã‹ã‹ã‚ã‚‰ãšï¼‰
- 11ä»¶ç›®ä»¥é™ã®ãƒ­ã‚°ã¯ã€7æ—¥ä»¥å†…ãªã‚‰ä¿æŒã€7æ—¥ã‚ˆã‚Šå¤ã‘ã‚Œã°å‰Šé™¤

### auto

`-w auto` ã§ AI ãŒãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•é¸æŠã™ã‚‹éš›ã®è¨­å®š

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `provider` | string | (agentè¨­å®šã‹ã‚‰æ¨å®š or `anthropic`) | AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ |
| `model` | string | `claude-haiku-4-5` | AIãƒ¢ãƒ‡ãƒ«ï¼ˆè»½é‡ãƒ»é«˜é€Ÿãªãƒ¢ãƒ‡ãƒ«æ¨å¥¨ï¼‰ |

#### ä½¿ç”¨ä¾‹

```yaml
auto:
  provider: anthropic
  model: claude-haiku-4-5
```

ç’°å¢ƒå¤‰æ•°ã§ã‚‚è¨­å®šå¯èƒ½:
```bash
PI_RUNNER_AUTO_PROVIDER=anthropic ./scripts/run.sh 42 -w auto
PI_RUNNER_AUTO_MODEL=claude-haiku-4-5 ./scripts/run.sh 42 -w auto
```

### workflowï¼ˆéæ¨å¥¨ï¼‰

> **âš ï¸ éæ¨å¥¨**: `workflow:`ï¼ˆå˜æ•°å½¢ï¼‰ã¯å¾Œæ–¹äº’æ›ã®ãŸã‚ã«æ®‹ã•ã‚Œã¦ã„ã¾ã™ã€‚æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ `workflows.default` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚`workflows.default` ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã€`workflow:` ã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚

`.pi-runner.yaml` ã® `workflow` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€`-w` ã‚ªãƒ—ã‚·ãƒ§ãƒ³æœªæŒ‡å®šæ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã—ã¾ã™ã€‚

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `steps` | string[] | `plan implement review merge` | å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ— |

> **æ³¨æ„**: `workflow.name` ã¯ `.pi-runner.yaml` ã§ã¯ç„¡è¦–ã•ã‚Œã¾ã™ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã«æ®‹ã•ã‚Œã¦ã„ã¾ã™ï¼‰ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åã‚’æŒ‡å®šã™ã‚‹å ´åˆã¯ `-w` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ `workflows` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¾ãŸã¯ `workflows/*.yaml` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

#### ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚¹ãƒ†ãƒƒãƒ—

| ã‚¹ãƒ†ãƒƒãƒ— | èª¬æ˜ |
|---------|------|
| `plan` | å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆ |
| `implement` | ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£… |
| `review` | ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| `merge` | PRã‚’ä½œæˆã—ã¦ãƒãƒ¼ã‚¸ |
| `test` | ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ |
| `ci-fix` | CIå¤±æ•—ã‚’ä¿®æ­£ |

#### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹

```yaml
# .pi-runner.yaml
# ã“ã®è¨­å®šã¯ `./scripts/run.sh 42` ï¼ˆ-w ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã—ï¼‰ã§ä½¿ç”¨ã•ã‚Œã‚‹
workflow:
  steps:
    - plan
    - implement
    - review
    - merge

# ç°¡æ˜“ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«å¤‰æ›´ã™ã‚‹å ´åˆ
workflow:
  steps:
    - implement
    - merge
```

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã™ã‚‹å ´åˆ**:
```bash
# workflows/simple.yaml ã‚’ä½¿ç”¨
./scripts/run.sh 42 -w simple

# .pi-runner.yaml ã® workflows.quick ã‚’ä½¿ç”¨
./scripts/run.sh 42 -w quick

# AI ãŒè‡ªå‹•é¸æŠ
./scripts/run.sh 42 -w auto
```

è©³ç´°ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦ã¯ [ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./workflows.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### workflows

> **æ–°æ©Ÿèƒ½**: è¤‡æ•°ã®åå‰ä»˜ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ `.pi-runner.yaml` å†…ã§å®šç¾©ã§ãã¾ã™ã€‚

`.pi-runner.yaml` ã® `workflows` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è¤‡æ•°ã®åå‰ä»˜ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã§ãã¾ã™ã€‚`-w NAME` ã§æ˜ç¤ºçš„ã«é¸æŠã™ã‚‹ã‹ã€`-w auto` ã§ AI ãŒè‡ªå‹•é¸æŠã—ã¾ã™ã€‚

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `{name}.description` | string | (ãªã—) | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®èª¬æ˜ï¼ˆ`--list-workflows` ã¨ `-w auto` ã§ä½¿ç”¨ï¼‰ |
| `{name}.steps` | string[] | (å¿…é ˆ) | å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ— |
| `{name}.context` | string | (ãªã—) | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å›ºæœ‰ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå…¨ã‚¹ãƒ†ãƒƒãƒ—ã«æ³¨å…¥ï¼‰ |

#### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```yaml
# .pi-runner.yaml
workflows:
  quick:
    description: å°è¦æ¨¡ä¿®æ­£ï¼ˆtypoã€è¨­å®šå¤‰æ›´ã€1ãƒ•ã‚¡ã‚¤ãƒ«ç¨‹åº¦ã®å¤‰æ›´ï¼‰
    steps:
      - implement
      - merge
  
  thorough:
    description: å¤§è¦æ¨¡æ©Ÿèƒ½é–‹ç™ºï¼ˆè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã€æ–°æ©Ÿèƒ½ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´ï¼‰
    steps:
      - plan
      - implement
      - test
      - review
      - merge
```

**å®Ÿè¡Œ**:
```bash
# quick ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨
./scripts/run.sh 42 -w quick

# thorough ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨
./scripts/run.sh 42 -w thorough

# åˆ©ç”¨å¯èƒ½ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¸€è¦§
./scripts/run.sh --list-workflows
```

#### description ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

`description` ã¯2ã¤ã®ç”¨é€”ã§ä½¿ç”¨ã•ã‚Œã¾ã™ï¼š

1. **`--list-workflows`**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸ã¶ã¨ãã®å‚è€ƒæƒ…å ±
2. **`-w auto`**: AI ãŒ Issue å†…å®¹ã¨ç…§åˆã—ã¦æœ€é©ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠã™ã‚‹éš›ã®åˆ¤æ–­åŸºæº–

> **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**: `description` ã‚’å…·ä½“çš„ã«æ›¸ãã»ã© AI ã®è‡ªå‹•é¸æŠç²¾åº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚æ›–æ˜§ãª description ã¯èª¤é¸æŠã®åŸå› ã«ãªã‚‹ãŸã‚ã€å¯¾è±¡ã¨ãªã‚‹ã‚¿ã‚¹ã‚¯ã®ç‰¹å¾´ã‚’æ˜ç¢ºã«è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚

#### context ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

`context` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨˜è¿°ã—ãŸå†…å®¹ã¯ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å…¨ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã€ŒWorkflow Contextã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ³¨å…¥ã•ã‚Œã¾ã™ã€‚æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã€é‡è¦–ã™ã¹ãç‚¹ã€æ³¨æ„äº‹é …ãªã©ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```yaml
# .pi-runner.yaml
workflows:
  frontend:
    description: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆReact/Next.jsã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã€ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
    steps:
      - plan
      - implement
      - review
      - merge
    context: |
      ## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
      - React / Next.js / TypeScript
      - TailwindCSS
      
      ## é‡è¦–ã™ã¹ãç‚¹
      - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
      - ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ (WCAG 2.1 AA)
      - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†åˆ©ç”¨æ€§
      - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆCore Web Vitalsï¼‰
  
  backend:
    description: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå®Ÿè£…ï¼ˆDBæ“ä½œã€èªè¨¼ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‡¦ç†ï¼‰
    steps:
      - plan
      - implement
      - test
      - review
      - merge
    context: |
      ## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
      - Node.js / Express / TypeScript
      - PostgreSQL / Prisma
      
      ## é‡è¦–ã™ã¹ãç‚¹
      - RESTful APIè¨­è¨ˆ
      - å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ã‚°
      - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆã®å……å®Ÿ
```

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¸ã®æ³¨å…¥ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼š

```markdown
## Workflow: frontend

### Workflow Context

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- React / Next.js / TypeScript
- TailwindCSS

## é‡è¦–ã™ã¹ãç‚¹
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ (WCAG 2.1 AA)
...

---

### Step 1: Plan
...
```

#### ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã®ä½¿ç”¨

ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ`plan`, `implement`, `test`, `review`, `merge`, `ci-fix`ï¼‰ä»¥å¤–ã«ã€ä»»æ„ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®šç¾©ã§ãã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½¿ã†å ´åˆã¯ã€å¯¾å¿œã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ `agents/{step}.md` ã«é…ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```yaml
# .pi-runner.yaml
workflows:
  design:
    description: è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆï¼ˆæŠ€è¡“èª¿æŸ»ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆã€ADRã€ä»•æ§˜æ›¸ï¼‰
    steps:
      - research  # ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—
      - design    # ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—
      - review
      - merge
    context: |
      ## ç›®çš„
      ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã§ã¯ãªãã€è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½œæˆã«ç‰¹åŒ–ã™ã‚‹ã€‚
      
      ## æˆæœç‰©
      - docs/ ä»¥ä¸‹ã« Markdown ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆ
      - ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯åŸå‰‡è¡Œã‚ãªã„
```

å¯¾å¿œã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ`agents/research.md`ï¼‰ã‚’ä½œæˆï¼š

```markdown
# agents/research.md
GitHub Issue #{{issue_number}} ã«é–¢ã™ã‚‹æŠ€è¡“èª¿æŸ»ã‚’è¡Œã„ã¾ã™ã€‚

## ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- **Issue**: #{{issue_number}} {{issue_title}}
- **ãƒ–ãƒ©ãƒ³ãƒ**: {{branch_name}}

## ã‚¿ã‚¹ã‚¯
1. Issue ã®è¦ä»¶ã‚’åˆ†æã—ã€è§£æ±ºã™ã¹ãèª²é¡Œã‚’æ˜ç¢ºåŒ–
2. é–¢é€£ã™ã‚‹æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª¿æŸ»
3. å¤–éƒ¨ã®æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ç¢ºèª
4. æŠ€è¡“çš„ãªé¸æŠè‚¢ã¨åˆ¶ç´„ã‚’æ´—ã„å‡ºã™
5. èª¿æŸ»çµæœã‚’ docs/ ä»¥ä¸‹ã«ãƒ¡ãƒ¢ã¨ã—ã¦ã¾ã¨ã‚ã‚‹

## æ³¨æ„
- ã“ã®æ®µéšã§ã¯ã‚³ãƒ¼ãƒ‰ã®å®Ÿè£…ã¯è¡Œã‚ãªã„
- èª¿æŸ»çµæœã¯æ¬¡ã® design ã‚¹ãƒ†ãƒƒãƒ—ã§ä½¿ç”¨ã•ã‚Œã‚‹
```

> **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œç´¢é †åº**: `agents/{step}.md` â†’ `.pi/agents/{step}.md` â†’ ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€‚ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã® `implement` ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

#### -w auto: AI ã«ã‚ˆã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è‡ªå‹•é¸æŠ

`-w auto` ã‚’æŒ‡å®šã™ã‚‹ã¨ï¼ˆ`workflows` ã‚»ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©æ™‚ã¯çœç•¥ã§ã‚‚è‡ªå‹•é©ç”¨ï¼‰ã€AI ãŒ Issue ã®å†…å®¹ã‚’åˆ†æã—ã¦æœ€é©ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’äº‹å‰é¸æŠã—ã€ãã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ`agents/*.md`ï¼‰ãŒå±•é–‹ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash
# AI ãŒ Issue #42 ã®å†…å®¹ã‚’è¦‹ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•é¸æŠ
./scripts/run.sh 42 -w auto

# workflows ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Œã°çœç•¥å¯
./scripts/run.sh 42
```

**é¸æŠã®æµã‚Œï¼ˆ2æ®µéšå‡¦ç†ï¼‰:**

1. **äº‹å‰é¸æŠ**: `pi --print` + è»½é‡ãƒ¢ãƒ‡ãƒ«ï¼ˆhaikuï¼‰ã§ã€Issue ã® `title` / `body` ã¨å„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã® `description` ã‚’ç…§åˆã—ã¦æœ€é©ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åã‚’åˆ¤å®š
2. **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ**: é¸æŠã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§é€šå¸¸ã® `generate_workflow_prompt()` ã‚’å®Ÿè¡Œã—ã€`agents/*.md` ã®å…·ä½“çš„ãªã‚¹ãƒ†ãƒƒãƒ—æŒ‡ç¤ºãŒå±•é–‹ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ

**ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:**

AIå‘¼ã³å‡ºã—ãŒå¤±æ•—ã—ãŸå ´åˆã¯ã€Issue ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆ`feat:` â†’ feature, `fix:` â†’ fix, `docs:` â†’ docs ç­‰ï¼‰ã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹åˆ¤å®šã€ã•ã‚‰ã«å¤±æ•—ã—ãŸå ´åˆã¯ `default` ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚

**è¨­å®šï¼ˆ`.pi-runner.yaml`ï¼‰:**

```yaml
auto:
  provider: anthropic                # AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆçœç•¥æ™‚: agentè¨­å®šã‹ã‚‰æ¨å®š or anthropicï¼‰
  model: claude-haiku-4-5   # è»½é‡ãƒ¢ãƒ‡ãƒ«æ¨å¥¨ï¼ˆçœç•¥æ™‚: claude-haiku-4-5ï¼‰
```

> **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**: AI ãŒæ­£ç¢ºã«é¸æŠã§ãã‚‹ã‚ˆã†ã€`description` ã«ã¯å¯¾è±¡ã¨ãªã‚‹ã‚¿ã‚¹ã‚¯ã®ç‰¹å¾´ï¼ˆè¦æ¨¡ã€é ˜åŸŸã€æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ãªã©ï¼‰ã‚’å…·ä½“çš„ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

#### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åã®é‡è¤‡

`.pi-runner.yaml` ã® `workflows` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨åŒåã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆä¾‹: `ci-fix`ï¼‰ã‚’å®šç¾©ã—ãŸå ´åˆã€**`.pi-runner.yaml` ã®å®šç¾©ãŒå„ªå…ˆã•ã‚Œã¾ã™**ã€‚`--list-workflows` ã§ã¯é‡è¤‡ã‚’æ’é™¤ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®šç¾©ã‚’å„ªå…ˆè¡¨ç¤ºã—ã¾ã™ã€‚

```yaml
# .pi-runner.yaml
workflows:
  # ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã® ci-fix ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
  ci-fix:
    description: ã‚«ã‚¹ã‚¿ãƒ CIä¿®æ­£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ«ãƒ¼ãƒ«é©ç”¨ï¼‰
    steps:
      - ci-fix
    context: |
      ## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®CIè¨­å®š
      - pre-commit hooks ã‚’ä½¿ç”¨
      - ç‰¹å®šã®linterãƒ«ãƒ¼ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ãªã„
```

#### workflow vs workflows ã®é–¢ä¿‚

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | ç”¨é€” | `-w` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |
|-----------|------|---------------|
| `workflow` | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | æœªæŒ‡å®šæ™‚ã«ä½¿ç”¨ |
| `workflows` | åå‰ä»˜ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | `-w NAME` ã¾ãŸã¯ `-w auto` ã§é¸æŠ |

ä¸¡æ–¹ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æŒã¡ã¤ã¤ã€çŠ¶æ³ã«å¿œã˜ã¦åˆ¥ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠã§ãã¾ã™ã€‚

```yaml
# .pi-runner.yaml
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆ-w ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã—ï¼‰
workflow:
  steps:
    - plan
    - implement
    - review
    - merge

# åå‰ä»˜ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆ-w ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§é¸æŠï¼‰
workflows:
  quick:
    description: å°è¦æ¨¡ä¿®æ­£
    steps:
      - implement
      - merge
  
  frontend:
    description: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
    steps:
      - plan
      - implement
      - review
      - merge
    context: |
      æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯: React / Next.js
```

ä½¿ç”¨ä¾‹ï¼š
```bash
./scripts/run.sh 42          # workflow ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨
./scripts/run.sh 42 -w quick # workflows.quick ã‚’ä½¿ç”¨
./scripts/run.sh 42 -w auto  # AI ãŒ workflows ã‹ã‚‰é¸æŠ
```

### github

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `include_comments` | boolean | `true` | Issueã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å«ã‚ã‚‹ã‹ |
| `max_comments` | integer | `10` | å–ã‚Šè¾¼ã‚€ã‚³ãƒ¡ãƒ³ãƒˆã®æœ€å¤§æ•°ï¼ˆ0 = ç„¡åˆ¶é™ï¼‰ |

#### ä½¿ç”¨ä¾‹

```yaml
github:
  include_comments: true  # Issueã‚³ãƒ¡ãƒ³ãƒˆã‚’å«ã‚ã‚‹
  max_comments: 10        # æœ€æ–°10ä»¶ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿
```

### hooks

#### å…±é€šè¨­å®š

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `allow_inline` | boolean | `false` | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³hookã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã‚’è¨±å¯ã™ã‚‹ã€‚`true` ã«ã™ã‚‹ã¨ `.pi-runner.yaml` ã«ç›´æ¥æ›¸ã„ãŸã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ |

> **Note**: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³hookï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã§ã¯ãªãã‚³ãƒãƒ³ãƒ‰æ–‡å­—åˆ—ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ `allow_inline: true` ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
> ç’°å¢ƒå¤‰æ•° `PI_RUNNER_HOOKS_ALLOW_INLINE=true` ã§ã‚‚ä¸Šæ›¸ãå¯èƒ½ã§ã™ã€‚

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `on_start` | string | (ãªã—) | ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ |
| `on_success` | string | (ãªã—) | ã‚»ãƒƒã‚·ãƒ§ãƒ³æˆåŠŸæ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ |
| `on_error` | string | (ãªã—) | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ |
| `on_cleanup` | string | (ãªã—) | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ |

#### ç¶™ç¶šçš„æ”¹å–„ï¼ˆimprove.shï¼‰ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `on_improve_start` | string | (ãªã—) | improve.sh å…¨ä½“ã®é–‹å§‹æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ |
| `on_improve_end` | string | (ãªã—) | improve.sh å…¨ä½“ã®çµ‚äº†æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ |
| `on_iteration_start` | string | (ãªã—) | å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ |
| `on_iteration_end` | string | (ãªã—) | å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ |
| `on_review_complete` | string | (ãªã—) | ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ãƒ»Issueä½œæˆå‰ã«å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ |

#### ä½¿ç”¨ä¾‹

```yaml
hooks:
  # ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«
  # ä¾‹: ./hooks/notify-start.sh (ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆ)
  on_start: ./hooks/notify-start.sh
  on_success: echo "Task completed for Issue #$PI_ISSUE_NUMBER"
  on_error: |
    curl -X POST https://example.com/webhook \
      -H 'Content-Type: application/json' \
      -d "{\"issue\": \"$PI_ISSUE_NUMBER\", \"error\": \"$PI_ERROR_MESSAGE\"}"
  # ä¾‹: ./hooks/cleanup-resources.sh (ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆ)
  on_cleanup: ./hooks/cleanup-resources.sh
  
  # ç¶™ç¶šçš„æ”¹å–„ï¼ˆimprove.shï¼‰ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«
  on_improve_start: |
    echo "ğŸ”„ Improve started: iteration $PI_ITERATION/$PI_MAX_ITERATIONS"
  on_review_complete: |
    echo "ğŸ“‹ Review found $PI_REVIEW_ISSUES_COUNT issues"
  on_iteration_end: |
    echo "âœ… Iteration $PI_ITERATION: $PI_ISSUES_SUCCEEDED succeeded, $PI_ISSUES_FAILED failed"
  on_improve_end: |
    osascript -e 'display notification "æ”¹å–„å®Œäº†: $PI_ISSUES_SUCCEEDED/$PI_ISSUES_CREATED æˆåŠŸ" with title "Pi Runner"'
```

#### ç’°å¢ƒå¤‰æ•°

hookã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¯ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ãŒæ¸¡ã•ã‚Œã¾ã™ï¼š

**ã‚»ãƒƒã‚·ãƒ§ãƒ³é–¢é€£**:

| ç’°å¢ƒå¤‰æ•° | èª¬æ˜ | åˆ©ç”¨å¯èƒ½ã‚¤ãƒ™ãƒ³ãƒˆ |
|----------|------|-----------------|
| `PI_ISSUE_NUMBER` | Issueç•ªå· | on_start, on_success, on_error, on_cleanup |
| `PI_ISSUE_TITLE` | Issueã‚¿ã‚¤ãƒˆãƒ« | on_start, on_success, on_error, on_cleanup |
| `PI_SESSION_NAME` | ã‚»ãƒƒã‚·ãƒ§ãƒ³å | on_start, on_success, on_error, on_cleanup |
| `PI_BRANCH_NAME` | ãƒ–ãƒ©ãƒ³ãƒå | on_start, on_success, on_error, on_cleanup |
| `PI_WORKTREE_PATH` | worktreeãƒ‘ã‚¹ | on_start, on_success, on_error, on_cleanup |
| `PI_ERROR_MESSAGE` | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | on_error |
| `PI_EXIT_CODE` | çµ‚äº†ã‚³ãƒ¼ãƒ‰ | on_error, on_cleanup |

**ç¶™ç¶šçš„æ”¹å–„ï¼ˆimprove.shï¼‰é–¢é€£**:

| ç’°å¢ƒå¤‰æ•° | èª¬æ˜ | åˆ©ç”¨å¯èƒ½ã‚¤ãƒ™ãƒ³ãƒˆ |
|----------|------|-----------------|
| `PI_ITERATION` | ç¾åœ¨ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç•ªå· | on_iteration_start, on_iteration_end, on_review_complete |
| `PI_MAX_ITERATIONS` | æœ€å¤§ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•° | on_improve_start, on_improve_end, on_iteration_start, on_iteration_end, on_review_complete |
| `PI_ISSUES_CREATED` | ä½œæˆã•ã‚ŒãŸIssueæ•° | on_iteration_end, on_improve_end |
| `PI_ISSUES_SUCCEEDED` | æˆåŠŸã—ãŸIssueæ•° | on_iteration_end, on_improve_end |
| `PI_ISSUES_FAILED` | å¤±æ•—ã—ãŸIssueæ•° | on_iteration_end, on_improve_end |
| `PI_REVIEW_ISSUES_COUNT` | ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œæ•° | on_review_complete |

> **âš ï¸ éæ¨å¥¨**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ï¼ˆ`{{issue_number}}`ç­‰ï¼‰ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã«ã‚ˆã‚Šéæ¨å¥¨ã§ã™ã€‚
> ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚è©³ç´°ã¯ [Hookæ©Ÿèƒ½ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./hooks.md#ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### tracker

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåŠ¹æœæ¸¬å®šï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆ¥æˆåŠŸç‡ã®è¨˜éŒ²ï¼‰ã®è¨­å®š

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `file` | string | `.worktrees/.status/tracker.jsonl` | ãƒˆãƒ©ãƒƒã‚«ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ |

#### ä½¿ç”¨ä¾‹

```yaml
tracker:
  file: ".worktrees/.status/tracker.jsonl"
```

ç’°å¢ƒå¤‰æ•°ã§ã‚‚è¨­å®šå¯èƒ½:
```bash
PI_RUNNER_TRACKER_FILE=".tracker/results.jsonl" ./scripts/run.sh 42
```

### gates

å“è³ªã‚²ãƒ¼ãƒˆè¨­å®šï¼ˆCOMPLETEãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºå¾Œã®è‡ªå‹•å“è³ªãƒã‚§ãƒƒã‚¯ï¼‰

ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã® `gates` ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å›ºæœ‰ã® gates ãŒæœªå®šç¾©æ™‚ã«é©ç”¨ï¼‰ã€‚
ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å›ºæœ‰ã® gates ã¯ `workflows.<name>.gates` ã§å®šç¾©ã€‚

#### ä½¿ç”¨ä¾‹

```yaml
# ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚²ãƒ¼ãƒˆ
gates:
  - "shellcheck -x scripts/*.sh lib/*.sh"
  - "bats --jobs 4 test/"

# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å›ºæœ‰
workflows:
  default:
    steps: [plan, implement, merge]
    gates:
      - "shellcheck -x scripts/*.sh lib/*.sh"
      - command: "bats test/"
        timeout: 600
        max_retry: 1
        description: "Batsãƒ†ã‚¹ãƒˆ"
      - call: code-review
        max_retry: 2
```

#### ã‚²ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆè©³ç´°å½¢å¼ï¼‰

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `command` | string | - | å®Ÿè¡Œã™ã‚‹ã‚·ã‚§ãƒ«ã‚³ãƒãƒ³ãƒ‰ |
| `call` | string | - | ã‚²ãƒ¼ãƒˆã¨ã—ã¦å‘¼ã³å‡ºã™ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å |
| `timeout` | integer | 300 | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰ |
| `max_retry` | integer | 0 | ãƒªãƒˆãƒ©ã‚¤å›æ•° |
| `retry_interval` | integer | 10 | ãƒªãƒˆãƒ©ã‚¤é–“éš”ï¼ˆç§’ï¼‰ |
| `continue_on_fail` | boolean | false | å¤±æ•—ã—ã¦ã‚‚æ¬¡ã®ã‚²ãƒ¼ãƒˆã«ç¶šè¡Œ |
| `description` | string | - | ãƒ­ã‚°è¡¨ç¤ºç”¨ã®èª¬æ˜ |

è©³ç´°ã¯ [gates.md](gates.md) ã‚’å‚ç…§ã€‚

### agents

| ã‚­ãƒ¼ | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|------|-----------|------|
| `{step}` | string | (ãƒ“ãƒ«ãƒˆã‚¤ãƒ³) | ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ« |

#### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä½œæˆ

```markdown
<!-- agents/plan.md -->
# Plan Agent

GitHub Issue #{{issue_number}} ã®å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆã—ã¾ã™ã€‚

## ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- **Issue**: #{{issue_number}} - {{issue_title}}
- **ãƒ–ãƒ©ãƒ³ãƒ**: {{branch_name}}
- **Worktree**: {{worktree_path}}

## ã‚¿ã‚¹ã‚¯
1. Issueå†…å®¹ã‚’åˆ†æ
2. å®Ÿè£…æ–¹é‡ã‚’æ±ºå®š
3. ä½œæ¥­é …ç›®ã‚’ãƒªã‚¹ãƒˆåŒ–
```

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä½¿ç”¨å¯èƒ½ãªå¤‰æ•°ã«ã¤ã„ã¦ã¯ã€[ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](#ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

Pi Issue Runnerã§ã¯ã€2ã¤ã®ç•°ãªã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒãƒ³ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ`agent.template`ï¼‰

ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆ`agent.type: custom`ï¼‰ã®ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

| å¤‰æ•° | èª¬æ˜ | ä¾‹ |
|------|------|-----|
| `{{command}}` | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒãƒ³ãƒ‰ | `my-agent` |
| `{{args}}` | å¼•æ•°ï¼ˆagent.args + --agent-argsï¼‰ | `--verbose --timeout 60` |
| `{{prompt_file}}` | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ | `/tmp/prompt-plan.md` |

**ä½¿ç”¨ä¾‹**:
```yaml
agent:
  type: custom
  command: my-agent
  template: '{{command}} {{args}} --file "{{prompt_file}}"'
```

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ`agents/*.md`ï¼‰

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆMarkdownï¼‰å†…ã§ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

| å¤‰æ•° | èª¬æ˜ | ä¾‹ |
|------|------|-----|
| `{{issue_number}}` | GitHub Issueç•ªå· | `411` |
| `{{issue_title}}` | Issueã‚¿ã‚¤ãƒˆãƒ« | `docs: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ä¸€è¦§ã®çµ±åˆ` |
| `{{branch_name}}` | ãƒ–ãƒ©ãƒ³ãƒå | `issue-411-docs` |
| `{{worktree_path}}` | worktreeã®ãƒ‘ã‚¹ | `.worktrees/issue-411` |
| `{{step_name}}` | ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—å | `plan`, `implement` |
| `{{workflow_name}}` | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å | `default`, `simple` |
| `{{plans_dir}}` | è¨ˆç”»æ›¸ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ | `docs/plans` |
| `{{signal_dir}}` | ã‚·ã‚°ãƒŠãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ | `.worktrees/.status` |
| `{{pr_number}}` | PRç•ªå· | `123` |

**ä½¿ç”¨ä¾‹**:
```markdown
<!-- agents/plan.md -->
# Plan Agent

GitHub Issue #{{issue_number}} ã®å®Ÿè£…è¨ˆç”»ã‚’ä½œæˆã—ã¾ã™ã€‚

## ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- **Issue**: #{{issue_number}} - {{issue_title}}
- **ãƒ–ãƒ©ãƒ³ãƒ**: {{branch_name}}
- **Worktree**: {{worktree_path}}
```

### å®Ÿè£…ã¨ã®æ•´åˆæ€§

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã®å®Ÿè£…ã¯ `lib/template.sh` ã® `render_template()` é–¢æ•°ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚æ–°ã—ã„å¤‰æ•°ã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã€ã“ã®é–¢æ•°ã‚‚æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹ä¸Šæ›¸ã

ã™ã¹ã¦ã®è¨­å®šã¯ç’°å¢ƒå¤‰æ•°ã§ä¸Šæ›¸ãå¯èƒ½ã§ã™ã€‚

| ç’°å¢ƒå¤‰æ•° | è¨­å®šé …ç›® |
|---------|---------|
| `PI_RUNNER_WORKTREE_BASE_DIR` | `worktree.base_dir` |
| `PI_RUNNER_WORKTREE_BASE_BRANCH` | `worktree.base_branch` |
| `PI_RUNNER_WORKTREE_COPY_FILES` | `worktree.copy_files` |
| `PI_RUNNER_MULTIPLEXER_TYPE` | `multiplexer.type` |
| `PI_RUNNER_MULTIPLEXER_SESSION_PREFIX` | `multiplexer.session_prefix` |
| `PI_RUNNER_MULTIPLEXER_START_IN_SESSION` | `multiplexer.start_in_session` |
| `PI_RUNNER_PI_COMMAND` | `pi.command` |
| `PI_RUNNER_PI_ARGS` | `pi.args` |
| `PI_RUNNER_AGENT_TYPE` | `agent.type` |
| `PI_RUNNER_AGENT_COMMAND` | `agent.command` |
| `PI_RUNNER_AGENT_ARGS` | `agent.args` |
| `PI_RUNNER_AGENT_TEMPLATE` | `agent.template` |
| `PI_RUNNER_AGENTS_PLAN` | `agents.plan` |
| `PI_RUNNER_AGENTS_IMPLEMENT` | `agents.implement` |
| `PI_RUNNER_AGENTS_REVIEW` | `agents.review` |
| `PI_RUNNER_AGENTS_MERGE` | `agents.merge` |
| `PI_RUNNER_AGENTS_TEST` | `agents.test` |
| `PI_RUNNER_AGENTS_CI_FIX` | `agents.ci-fix` |
| `PI_RUNNER_PARALLEL_MAX_CONCURRENT` | `parallel.max_concurrent` |
| `PI_RUNNER_PLANS_KEEP_RECENT` | `plans.keep_recent` |
| `PI_RUNNER_PLANS_DIR` | `plans.dir` |
| `PI_RUNNER_GITHUB_INCLUDE_COMMENTS` | `github.include_comments` |
| `PI_RUNNER_GITHUB_MAX_COMMENTS` | `github.max_comments` |
| `PI_RUNNER_IMPROVE_REVIEW_PROMPT_FILE` | `improve.review_prompt_file` |
| `PI_RUNNER_IMPROVE_LOGS_KEEP_RECENT` | `improve.logs.keep_recent` |
| `PI_RUNNER_IMPROVE_LOGS_KEEP_DAYS` | `improve.logs.keep_days` |
| `PI_RUNNER_IMPROVE_LOGS_DIR` | `improve.logs.dir` |
| `PI_RUNNER_HOOKS_ALLOW_INLINE` | `hooks.allow_inline` |
| `PI_RUNNER_HOOKS_ON_START` | `hooks.on_start` |
| `PI_RUNNER_HOOKS_ON_SUCCESS` | `hooks.on_success` |
| `PI_RUNNER_HOOKS_ON_ERROR` | `hooks.on_error` |
| `PI_RUNNER_HOOKS_ON_CLEANUP` | `hooks.on_cleanup` |
| `PI_RUNNER_HOOKS_ON_IMPROVE_START` | `hooks.on_improve_start` |
| `PI_RUNNER_HOOKS_ON_IMPROVE_END` | `hooks.on_improve_end` |
| `PI_RUNNER_HOOKS_ON_ITERATION_START` | `hooks.on_iteration_start` |
| `PI_RUNNER_HOOKS_ON_ITERATION_END` | `hooks.on_iteration_end` |
| `PI_RUNNER_HOOKS_ON_REVIEW_COMPLETE` | `hooks.on_review_complete` |
| `PI_RUNNER_AUTO_PROVIDER` | `auto.provider` |
| `PI_RUNNER_AUTO_MODEL` | `auto.model` |
| `PI_RUNNER_WATCHER_INITIAL_DELAY` | `watcher.initial_delay` |
| `PI_RUNNER_WATCHER_CLEANUP_DELAY` | `watcher.cleanup_delay` |
| `PI_RUNNER_WATCHER_CLEANUP_RETRY_INTERVAL` | `watcher.cleanup_retry_interval` |
| `PI_RUNNER_WATCHER_PR_MERGE_MAX_ATTEMPTS` | `watcher.pr_merge_max_attempts` |
| `PI_RUNNER_WATCHER_PR_MERGE_RETRY_INTERVAL` | `watcher.pr_merge_retry_interval` |
| `PI_RUNNER_WATCHER_FORCE_CLEANUP_ON_TIMEOUT` | `watcher.force_cleanup_on_timeout` |
| `PI_RUNNER_TRACKER_FILE` | `tracker.file` |

### ä¾‹: CIç’°å¢ƒã§ã®ä½¿ç”¨

```bash
export PI_RUNNER_PI_COMMAND="/opt/pi/bin/pi"
export PI_RUNNER_PARALLEL_MAX_CONCURRENT=2
./scripts/run.sh 42
```

### ä¾‹: Claude Codeã‚’ä½¿ç”¨

```bash
export PI_RUNNER_AGENT_TYPE="claude"
./scripts/run.sh 42
```

### ä¾‹: ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨

```bash
export PI_RUNNER_AGENTS_PLAN="custom/plan.md"
export PI_RUNNER_AGENTS_IMPLEMENT="custom/implement.md"
./scripts/run.sh 42
```

## ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«

`LOG_LEVEL` ç’°å¢ƒå¤‰æ•°ã§ãƒ­ã‚°ã®å‡ºåŠ›ãƒ¬ãƒ™ãƒ«ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚

### åˆ©ç”¨å¯èƒ½ãªãƒ­ã‚°ãƒ¬ãƒ™ãƒ«

| ãƒ¬ãƒ™ãƒ« | èª¬æ˜ |
|--------|------|
| `DEBUG` | ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’å«ã‚€å…¨ã¦ã®ãƒ­ã‚°ã‚’è¡¨ç¤º |
| `INFO` | ä¸€èˆ¬çš„ãªæƒ…å ±ãƒ­ã‚°ã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |
| `WARN` | è­¦å‘Šã¨ã‚¨ãƒ©ãƒ¼ã®ã¿è¡¨ç¤º |
| `ERROR` | ã‚¨ãƒ©ãƒ¼ã®ã¿è¡¨ç¤º |
| `QUIET` | ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãªã„ |

ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®å„ªå…ˆé †ä½: `DEBUG` < `INFO` < `WARN` < `ERROR` < `QUIET`

### ä½¿ç”¨ä¾‹

```bash
# ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¡¨ç¤ºï¼ˆãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ï¼‰
LOG_LEVEL=DEBUG ./scripts/run.sh 42

# ã‚¨ãƒ©ãƒ¼ã®ã¿è¡¨ç¤ºï¼ˆé™ã‹ã«å®Ÿè¡Œï¼‰
LOG_LEVEL=ERROR ./scripts/run.sh 42

# ãƒ­ã‚°ã‚’å®Œå…¨ã«æŠ‘åˆ¶
LOG_LEVEL=QUIET ./scripts/run.sh 42
```

## è¨­å®šã®å„ªå…ˆé †ä½

1. **ç’°å¢ƒå¤‰æ•°** (æœ€å„ªå…ˆ)
2. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**
3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤** (æœ€ä½å„ªå…ˆ)

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢é †åº

1. ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `.pi-runner.yaml`
2. è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é †ã«æ¤œç´¢
3. è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢é †åº

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¤œç´¢é †åºã¯ã€`-w` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚

### `-w` ã‚ªãƒ—ã‚·ãƒ§ãƒ³æœªæŒ‡å®šæ™‚ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼‰

```bash
./scripts/run.sh 42
```

| å„ªå…ˆé †ä½ | å ´æ‰€ | èª¬æ˜ |
|---------|------|------|
| 1 | `.pi-runner.yaml` ã® `workflow` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæ¨å¥¨ï¼‰ |
| 2 | `.pi/workflow.yaml` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ |
| 3 | `workflows/default.yaml` | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ |
| 4 | pi-issue-runner ã® `workflows/default.yaml` | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |
| 5 | ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ | ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼ˆplan â†’ implement â†’ review â†’ mergeï¼‰ |

### `-w NAME` æŒ‡å®šæ™‚ï¼ˆåå‰ä»˜ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼‰

```bash
./scripts/run.sh 42 -w simple
```

| å„ªå…ˆé †ä½ | å ´æ‰€ | èª¬æ˜ |
|---------|------|------|
| **1** | **`.pi-runner.yaml` ã® `workflows.{NAME}`** | ğŸ†• è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã®åå‰ä»˜ãå®šç¾©ï¼ˆ**æœ€å„ªå…ˆ**ï¼‰ |
| 2 | `.pi/workflow.yaml` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ï¼ˆå˜ä¸€å®šç¾©ï¼‰ |
| 3 | `workflows/{NAME}.yaml` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹: `workflows/simple.yaml`ï¼‰ |
| 4 | pi-issue-runner ã® `workflows/{NAME}.yaml` | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |
| 5 | ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ | ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼ˆdefault/simple/thorough/ci-fixï¼‰ |

> **é‡è¦**: `-w NAME` ã‚’æŒ‡å®šã—ãŸå ´åˆã€**`.pi-runner.yaml` ã® `workflows.{NAME}` ãŒæœ€å„ªå…ˆ**ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†æ•£ã•ã›ãšã« `.pi-runner.yaml` ä¸€ç®‡æ‰€ã§ç®¡ç†ã§ãã¾ã™ã€‚
> 
> **æ³¨æ„**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è¨­å®šï¼ˆ`.pi-runner.yaml` ã® `workflow` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã¯ã€`-w` ã‚ªãƒ—ã‚·ãƒ§ãƒ³æŒ‡å®šæ™‚ã«ã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€æ˜ç¤ºçš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æŒ‡å®šãŒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ˆã‚Šå„ªå…ˆã•ã‚Œã‚‹ãŸã‚ã§ã™ã€‚

### `-w auto` æŒ‡å®šæ™‚ï¼ˆAI è‡ªå‹•é¸æŠï¼‰

```bash
./scripts/run.sh 42 -w auto
```

æ¤œç´¢é †åºã¯é©ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚`.pi-runner.yaml` ã® `workflows` ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’èª­ã¿å–ã‚Šã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å«ã‚ã¾ã™ã€‚

- ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã¨åŒåã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®šç¾©ã‚’å„ªå…ˆ
- `workflows` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒæœªå®šç¾©ã®å ´åˆã¯ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¸€è¦§ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ä½¿ç”¨

AI ã¯ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦æœ€é©ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠã—ã¾ã™ï¼š
- Issue ã® `title` ã¨ `body`
- å„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã® `description`ã€`steps`ã€`context`

### åå‰ã®é‡è¤‡æ™‚ã®å„ªå…ˆé †ä½

`.pi-runner.yaml` ã® `workflows` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨åŒåã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆä¾‹: `ci-fix`ï¼‰ã‚’å®šç¾©ã—ãŸå ´åˆã€**`.pi-runner.yaml` ã®å®šç¾©ãŒå„ªå…ˆã•ã‚Œã¾ã™**ã€‚`--list-workflows` ã§ã¯é‡è¤‡ã‚’æ’é™¤ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®šç¾©ã‚’å„ªå…ˆè¡¨ç¤ºã—ã¾ã™ã€‚

### ä½¿ã„åˆ†ã‘ã®æŒ‡é‡

| æ–¹æ³• | ä½¿ç”¨ã‚·ãƒŠãƒªã‚ª | ä½¿ç”¨ä¾‹ |
|------|-------------|--------|
| `.pi-runner.yaml` ã® `workflow` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®šç¾© | `./scripts/run.sh 42` |
| `.pi-runner.yaml` ã® `workflows` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | è¤‡æ•°ã®åå‰ä»˜ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä¸€ç®‡æ‰€ã§ç®¡ç†ï¼ˆ**æ¨å¥¨**ï¼‰ | `./scripts/run.sh 42 -w quick` |
| `workflows/*.yaml` | å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ç®¡ç†ã—ãŸã„å ´åˆ | `./scripts/run.sh 42 -w simple` |
| `.pi/workflow.yaml` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ï¼‰ | `-w` ã®æœ‰ç„¡ã«ã‚ˆã£ã¦å‹•ä½œãŒç•°ãªã‚‹ |

**æ¨å¥¨æ§‹æˆ**ï¼ˆè¤‡æ•°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰ï¼š

```yaml
# .pi-runner.yaml
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
workflow:
  steps:
    - plan
    - implement
    - review
    - merge

# åå‰ä»˜ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆä¸€ç®‡æ‰€ã§ç®¡ç†ï¼‰
workflows:
  quick:
    description: å°è¦æ¨¡ä¿®æ­£
    steps:
      - implement
      - merge
  
  frontend:
    description: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
    steps:
      - plan
      - implement
      - review
      - merge
    context: |
      æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯: React / Next.js
```

**ä½¿ç”¨ä¾‹**ï¼š
```bash
./scripts/run.sh 42              # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆworkflowï¼‰
./scripts/run.sh 42 -w quick     # workflows.quick
./scripts/run.sh 42 -w frontend  # workflows.frontend
./scripts/run.sh 42 -w auto      # AI ãŒ workflows ã‹ã‚‰é¸æŠ
```

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢é †åº

1. `agents/{step}.md`
2. `.pi/agents/{step}.md`
3. ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

## è¨­å®šä¾‹

### é–‹ç™ºç’°å¢ƒ

```yaml
# .pi-runner.yaml (é–‹ç™º)
worktree:
  base_dir: ".worktrees"
  copy_files:
    - ".env.local"
    - ".envrc"

multiplexer:
  start_in_session: true

pi:
  args:
    - "--verbose"

parallel:
  max_concurrent: 3
```

### æœ¬ç•ªç’°å¢ƒï¼ˆCI/CDï¼‰

```yaml
# .pi-runner.yaml (æœ¬ç•ª)
worktree:
  base_dir: "/tmp/pi-worktrees"
  copy_files:
    - ".env.production"

multiplexer:
  start_in_session: false  # éå¯¾è©±ãƒ¢ãƒ¼ãƒ‰

parallel:
  max_concurrent: 10
```

### ãƒãƒ¼ãƒ é–‹ç™º

```yaml
# .pi-runner.yaml (ãƒãƒ¼ãƒ )
worktree:
  base_dir: ".worktrees"
  copy_files:
    - ".env.local"
    - ".npmrc"

parallel:
  max_concurrent: 5

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆ-w ã‚ªãƒ—ã‚·ãƒ§ãƒ³æœªæŒ‡å®šæ™‚ã«ä½¿ç”¨ï¼‰
workflow:
  steps:
    - plan
    - implement
    - review
    - merge
```

## è¨­å®šã®å®Ÿè£…è©³ç´°

è¨­å®šã¯è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å‡¦ç†ã•ã‚Œã¾ã™:

### åŸºæœ¬è¨­å®š: lib/config.sh

ä»¥ä¸‹ã®è¨­å®šã¯ `lib/config.sh` ã§å‡¦ç†ã•ã‚Œã¾ã™:
- `worktree.*` - worktreeã®ãƒ™ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
- `multiplexer.*` - ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µè¨­å®šï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³åã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…èµ·å‹•è¨­å®šï¼‰
- `pi.*` - piã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹ã€è¿½åŠ å¼•æ•°ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
- `agent.*` - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆã€ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã€å¼•æ•°ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- `parallel.*` - ä¸¦åˆ—å®Ÿè¡Œã®æœ€å¤§åŒæ™‚å®Ÿè¡Œæ•°
- `plans.*` - è¨ˆç”»æ›¸ã®ä¿æŒæ•°ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- `github.*` - Issueã‚³ãƒ¡ãƒ³ãƒˆã®å–ã‚Šè¾¼ã¿è¨­å®š

### ä¸»è¦ãªé–¢æ•°

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã™
find_config_file [start_dir]

# è¨­å®šã‚’èª­ã¿è¾¼ã‚€
load_config [config_file]

# è¨­å®šå€¤ã‚’å–å¾—
get_config <key>

# è¨­å®šã‚’å†èª­ã¿è¾¼ã¿ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
reload_config [config_file]

# è¨­å®šã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
show_config
```

### ä½¿ç”¨ä¾‹

```bash
source lib/config.sh

# è¨­å®šã‚’èª­ã¿è¾¼ã‚€
load_config

# è¨­å®šå€¤ã‚’å–å¾—
base_dir=$(get_config worktree_base_dir)
echo "Worktree directory: $base_dir"

# ãƒ‡ãƒãƒƒã‚°: å…¨è¨­å®šã‚’è¡¨ç¤º
show_config
```

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š: lib/workflow-loader.sh

ä»¥ä¸‹ã®è¨­å®šã¯ `lib/workflow-loader.sh` ã§å‡¦ç†ã•ã‚Œã¾ã™:
- `.pi-runner.yaml` å†…ã® `workflow.steps` - å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã®å®šç¾©
- `workflows/*.yaml` ãƒ•ã‚¡ã‚¤ãƒ« - ã‚«ã‚¹ã‚¿ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®šã®è©³ç´°ã¯ [ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](workflows.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### è¨­å®šãŒåæ˜ ã•ã‚Œãªã„

```bash
# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ç¢ºèª
DEBUG=1 ./scripts/run.sh 42

# ã¾ãŸã¯ show_config ã§ç¢ºèª
source lib/config.sh
load_config
show_config
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’ç¢ºèª
find .pi-runner.yaml

# è¨­å®šå†…å®¹ã‚’ç¢ºèªï¼ˆlib/config.shã®show_configé–¢æ•°ã‚’ä½¿ç”¨ï¼‰
source lib/config.sh
load_config
show_config
```

### yqãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

yqãŒã‚ã‚‹å ´åˆã¯ã‚ˆã‚Šæ­£ç¢ºã«YAMLã‚’è§£æã—ã¾ã™ã€‚yqãŒãªãã¦ã‚‚ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®ç°¡æ˜“ãƒ‘ãƒ¼ã‚µãƒ¼ã§å‹•ä½œã—ã¾ã™ã€‚

```bash
# macOS
brew install yq

# Ubuntu
sudo snap install yq
```

yqãŒãªã„å ´åˆã¯ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã«æˆ»ã™

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
rm .pi-runner.yaml
```

## ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨å®Ÿè£…ã®æ•´åˆæ€§æ¤œè¨¼

`lib/config.sh` ã®è¨­å®šé …ç›®ã¨ `docs/configuration.md` ã®æ•´åˆæ€§ã‚’è‡ªå‹•çš„ã«æ¤œè¨¼ã§ãã¾ã™ã€‚

```bash
# æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
./scripts/verify-config-docs.sh

# è©³ç´°å‡ºåŠ›
./scripts/verify-config-docs.sh --verbose
```

**æ¤œè¨¼å†…å®¹**:
- `lib/config.sh` ã§å®šç¾©ã•ã‚ŒãŸå…¨ã¦ã® `CONFIG_*` å¤‰æ•°ãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‹
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒæ­£ç¢ºã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆã‚µãƒ³ãƒ—ãƒ«æŠ½å‡ºï¼‰
- ä¸»è¦ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã‹

**çµ‚äº†ã‚³ãƒ¼ãƒ‰**:
- `0`: å…¨ãƒã‚§ãƒƒã‚¯æˆåŠŸ
- `1`: ä¸æ•´åˆæ¤œå‡º

**CIã§ã®ä½¿ç”¨**: ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ„ã¿è¾¼ã‚€ã“ã¨ã§ã€è¨­å®šé …ç›®ã®è¿½åŠ æ™‚ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°æ¼ã‚Œã‚’é˜²æ­¢ã§ãã¾ã™ã€‚

## å°†æ¥ã®æ‹¡å¼µäºˆå®š

ä»¥ä¸‹ã®æ©Ÿèƒ½ã¯å°†æ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å®Ÿè£…äºˆå®šã§ã™ï¼š

- `--config` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®š
- `multiplexer.log_output`: ã‚»ãƒƒã‚·ãƒ§ãƒ³å‡ºåŠ›ã®ãƒ•ã‚¡ã‚¤ãƒ«è¨˜éŒ²
- `pi.timeout`: ã‚¿ã‚¹ã‚¯ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
- `parallel.queue_strategy`: ã‚­ãƒ¥ãƒ¼æˆ¦ç•¥ï¼ˆfifo/priorityï¼‰
- `parallel.auto_cleanup`: å®Œäº†å¾Œã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- `github`: GitHub APIè¨­å®š
- `logging`: ãƒ­ã‚°è¨­å®š
- `notifications`: é€šçŸ¥è¨­å®šï¼ˆSlackç­‰ï¼‰
- `error`: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­å®š
- `resources`: ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™è¨­å®š
- JSONå½¢å¼ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒãƒ¼ãƒˆ

# 実装計画書: Issue #263

## 概要

`.pi-runner.yaml` 設定ファイルの詳細なドキュメントを更新・拡充する。現在のドキュメント（`docs/configuration.md`）は存在するが、Issue #263 で指定されたより包括的なフォーマットに更新する必要がある。

## 影響範囲

### 変更するファイル
1. `docs/configuration.md` - メインの設定ドキュメント（大幅な拡充）
2. `README.md` - 設定ドキュメントへのリンク確認（すでにリンクあり）

### 変更しないファイル
- `lib/config.sh` - 実装コードに変更なし
- `workflows/*.yaml` - ワークフロー定義に変更なし
- `agents/*.md` - エージェントテンプレートに変更なし

## 現状分析

### 既存ドキュメントの状況
- `docs/configuration.md` が存在（約7.4KB）
- 基本的な設定項目はカバーされている
- 環境変数、ログレベル、トラブルシューティングは記載済み

### 不足している内容（Issue要件との比較）
1. **完全な設定例** - より詳細なコメント付きの完全なYAML例
2. **ワークフロー設定** - `workflow` セクションの詳細説明
3. **エージェント設定** - `agents` セクションの詳細説明
4. **検索順序** - ワークフローファイル、エージェントファイルの検索順序
5. **テンプレート変数** - 利用可能な変数の一覧

## 実装ステップ

### 1. docs/configuration.md の更新

1.1 完全な設定例セクションの追加
   - 全設定オプションを網羅したYAML例
   - 各項目にコメントを追加

1.2 ワークフロー設定セクションの追加
   - `workflow` セクションの説明
   - ビルトインステップ一覧
   - カスタムワークフロー例

1.3 エージェント設定セクションの追加
   - `agents` セクションの説明
   - エージェントテンプレートの作成方法
   - テンプレート変数一覧

1.4 ファイル検索順序セクションの追加
   - 設定ファイルの検索順序
   - ワークフローファイルの検索順序
   - エージェントファイルの検索順序

1.5 トラブルシューティングの拡充
   - yq未インストール時の対応
   - 設定反映の確認方法

### 2. README.md の確認

2.1 設定ドキュメントへのリンク確認（すでにあり）

## テスト方針

### 確認項目
- [ ] ドキュメントのマークダウン構文が正しいこと
- [ ] コードブロックが正しくフォーマットされていること
- [ ] 内部リンクが正しいこと
- [ ] 設定例が実際の実装と一致していること

### 検証方法
- `lib/config.sh` と照合して設定項目の整合性を確認
- `workflows/*.yaml` と照合してワークフロー情報の正確性を確認
- `agents/*.md` と照合してテンプレート変数の正確性を確認

## リスクと対策

### リスク1: 実装との不整合
- **リスク**: ドキュメントが実際の実装と異なる可能性
- **対策**: `lib/config.sh` を参照して設定項目を確認

### リスク2: 既存ドキュメントの重複
- **リスク**: 既存の内容と新規内容の重複による冗長化
- **対策**: 既存構造を活かしつつ、不足部分を追加する形で更新

## 見積もり

- ドキュメント更新: 45分
- README.md確認: 5分
- レビュー・調整: 10分
- **合計: 約1時間**

## 完了条件

- [ ] `docs/configuration.md` が Issue #263 の要件を満たす
- [ ] 全設定項目が網羅されている
- [ ] 使用例が豊富に記載されている
- [ ] 環境変数による上書きが説明されている
- [ ] トラブルシューティングが追加されている
- [ ] README.md から configuration.md へのリンクがある

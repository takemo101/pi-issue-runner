# Issue #287 - 古いステータスファイルのクリーンアップ

## 概要

`.worktrees/.status/` ディレクトリに蓄積された孤立したステータスファイルをクリーンアップする機能を強化する。

## 現状分析

### 既存機能
- `./scripts/cleanup.sh --orphans`: 対応するworktreeが存在しないステータスファイルを検出・削除
- `./scripts/cleanup.sh --orphans --dry-run`: 削除せずに対象を表示

### 問題点
1. 現在44個の孤立したステータスファイルが存在
2. `--orphans` コマンドの存在が分かりにくい
3. 定期的なクリーンアップの仕組みがない

## 実装計画

### 1. 孤立ステータスファイルの即時クリーンアップ
**対象**: プロジェクトルートの `.worktrees/.status/` 
**方法**: `./scripts/cleanup.sh --orphans` を実行

### 2. cleanup.sh に `--all` オプション追加
**目的**: `--orphans` + `--delete-plans` を一括実行
**使用例**: `./scripts/cleanup.sh --all`

### 3. cleanup.sh に `--age` オプション追加
**目的**: 指定日数より古いステータスファイルを削除
**使用例**: `./scripts/cleanup.sh --age 7` (7日以上前のファイルを削除)

### 4. init.sh に孤立ファイル警告機能追加
**目的**: 初期化時に孤立したステータスファイルを検出して警告
**動作**: 孤立ファイルがあれば `cleanup.sh --orphans` の実行を推奨

## 影響範囲

| ファイル | 変更内容 |
|----------|----------|
| scripts/cleanup.sh | `--all`, `--age` オプション追加 |
| scripts/init.sh | 孤立ファイル警告機能追加 |
| lib/status.sh | `find_old_statuses()` 関数追加 |
| test/scripts/cleanup.bats | 新オプションのテスト追加 |
| test/scripts/init.bats | 警告機能のテスト追加 |

## テスト方針

1. **ユニットテスト**: lib/status.sh の新関数
2. **統合テスト**: cleanup.sh の新オプション、init.sh の警告機能
3. **手動テスト**: 実際の孤立ファイルクリーンアップ確認

## リスクと対策

| リスク | 対策 |
|--------|------|
| 誤って必要なステータスファイルを削除 | `--dry-run` をデフォルト推奨、孤立判定ロジックを厳密に |
| 日付ベース削除で進行中のセッションを削除 | worktree存在チェックと組み合わせ |

## 完了条件

- [x] 計画書作成
- [ ] 孤立ステータスファイルをクリーンアップ
- [ ] `--all` オプション実装・テスト
- [ ] `--age` オプション実装・テスト
- [ ] init.sh 警告機能実装・テスト
- [ ] 全テストパス

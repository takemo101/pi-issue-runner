# Issue #223 実装計画: run.sh のヘルプテキスト重複を解消

## 概要

`scripts/run.sh` に同じヘルプテキストが2箇所（早期ヘルプ処理とusage関数）に存在している。
この重複を解消し、メンテナンス性を向上させる。

## 問題分析

### 現状のコード構造

1. **Lines 11-46**: 早期ヘルプ処理（依存関係チェック前）
   - 目的: `--help` オプションを依存関係チェックより先に処理
   - 特徴: 静的なテキスト（`'HELP_EOF'`）を使用

2. **Lines 60-87**: `usage()` 関数
   - 目的: エラー時やヘルプ表示用
   - 特徴: `$(basename "$0")` で動的にスクリプト名を表示

### なぜ早期処理が必要か

- 依存関係（`gh`, `tmux` など）がインストールされていなくても `--help` が動作するようにするため
- 早期処理を削除すると、依存関係エラーが先に表示されてしまう

## 修正方針

**アプローチ**: `usage()` 関数を `source` 文より前に定義し、早期ヘルプ処理で再利用する

### 理由

1. シンプルで直感的
2. 追加ファイルが不要
3. 動的なスクリプト名表示を維持
4. 依存関係なしでヘルプが動作する機能を維持

## 影響範囲

- `scripts/run.sh` のみ

## 実装ステップ

1. **usage関数を移動**
   - `usage()` 関数を `source` 文の前に移動（Lines 7-8付近）

2. **早期ヘルプ処理を簡素化**
   - `cat << 'HELP_EOF' ... HELP_EOF` を `usage; exit 0` に置き換え

3. **main関数内のヘルプ処理**
   - 既存の `usage` 呼び出しはそのまま維持（変更不要）

## テスト方針

1. **ユニットテスト**
   - 既存の `--help` テストがパスすることを確認

2. **手動テスト**
   - `./scripts/run.sh --help` が正しく表示されるか確認
   - `./scripts/run.sh -h` が正しく表示されるか確認
   - 依存関係がなくてもヘルプが表示されるか確認（モック環境）

3. **回帰テスト**
   - 全テストスイートの実行: `./scripts/test.sh`

## リスクと対策

| リスク | 対策 |
|--------|------|
| `usage()` 関数が依存関係を使用している | 確認済み: `usage()` は依存関係を使用していない |
| テストが失敗する | 変更後にテストを実行し、失敗があれば修正 |

## 見積もり

- 実装: 10分
- テスト: 10分
- 合計: 20分

## 完了条件

- [x] Issueの要件を完全に理解した
- [x] 関連するコードを調査した
- [x] 実装計画書を作成した
- [x] 計画書をファイルに保存した
